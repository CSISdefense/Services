---
title: "Defense Services Exercised Options"
author: "Greg Sanders, Justin Graham"
date: "Friday July 13, 2019"
output:
  html_document:
    keep_md: yes
--- 

Modeling Likelihood of Some or All Options being Exercised
============================================================================

#Setup and  Load Data
First we load the data. The dataset used is a U.S. Defense Contracting dataset derived from FPDS.

```{r Libraries, echo = FALSE, results = FALSE, message = FALSE, warning = FALSE}
library(csis360)
library(ggplot2)
library(arm)
library(R2WinBUGS)
library(dplyr)
library(Hmisc)
library(stargazer)
library(optimx)
# source("C:/Users/JGraham/Documents/CSIS/Vendor/Scripts/DIIGstat.r")

axis.text.size<-10
strip.text.size<-10
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-1
note.text.size<-1.40

load(file="..//data//semi_clean//serv_opt.rdata")

```

Two models are employed throughout, one looking at the probability of some options being exercised  and the other looking at all (or at least 95%) options being exercised in dollar terms.  This approach was taken to avoid clustering at zero and one problems. The second model only includes as a sample those contracts with some options exercised, while the first model is calculated on the full dataset.

#Study Variables

##Services Complexity
Expectation: Higher service complexity would make work more demanding and thus raises the risks of negative contracting outcomes, namely the likelihood exercised options decreases.

### 01A NAICS6 Salary
Expectation: Given the fact that one source for higher salaries is the difficulty of the work and the experience and education required, as average NAICS6 salary increases, we expect likelihood of both some options being exercised and all options being exercised to decrease.

```{r Model01A}
summary_continuous_plot(serv_opt,metric="opt","cln_US6sal")


#Model
b_SomeOpt01A <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_US6sal, family=binomial(link="logit"))


b_AllOpt01A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_US6sal)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt01A,b_AllOpt01A,type="text",
                       digits=2)


```
Expectations are met.


### 01B Invoice Rate
Expectation: The invoice rate approximates how much the government is charged annually for each comparable full-time employee who is supporting the service contracts. A higher invoice rate indicates a more complex service. As invoice rate increases, we expect likelihood of both some options being exercised and all options being exercised to decrease.

```{r Model01B}

summary_continuous_plot(serv_opt,metric="opt","cln_PSCrate")


#Model
b_SomeOpt01B <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_PSCrate, family=binomial(link="logit"))

b_AllOpt01B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_PSCrate)



#Plot residuals versus fitted
  stargazer::stargazer(b_SomeOpt01A,b_SomeOpt01B,
                       b_AllOpt01A,b_AllOpt01B,
                       type="text",
                       digits=2)


```

Expectations met.

### 01C Service Complexity
Expectation: Collectively, the higher average salary and invoice rate (more complexity is indicated), we expect the likelihood of both some options being exercised and all options being exercised to decrease.

 
```{r Model01C}

#Model
b_SomeOpt01C <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_US6sal + cln_PSCrate, family=binomial(link="logit"))
glmer_examine(b_SomeOpt01C)

b_AllOpt01C <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_US6sal +  cln_PSCrate)

glmer_examine(b_AllOpt01C)
#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt01A,b_SomeOpt01B,b_SomeOpt01C,
                       
                       b_AllOpt01A,b_AllOpt01B,b_AllOpt01C,
                       type="text",
                       digits=2)

undebug(summary_residual_compare)
summary_residual_compare(b_SomeOpt01A,b_SomeOpt01C,b_SomeOpt01B, bins=3)
summary_residual_compare(b_AllOpt01A, b_AllOpt01C, b_AllOpt01B, bins=3)
```

Expectations are met for all variables, except for average salary in the model of some options being exercised, which is no longer statistically significant.

## Office Capacity

### 02A: Performance Based Services
Expectation: Performance-based services contracting ties a portion of a contractor's payment, contract extensions, or contract renewals to the achievement of specific, measurable performance standards and requirements, which encourages better contracting results. As percent PBSC increases, we expect likelihood of both some options being exercised and all options being exercised to increase.

```{r Model02A}
summary_continuous_plot(serv_opt,metric="opt","pPBSC")

#Model
b_SomeOpt02A <- glm (data=serv_opt,
                 b_SomeOpt ~ cp_OffPerf7, family=binomial(link="logit"))

b_AllOpt02A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cp_OffPerf7)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt01C,b_SomeOpt02A,
                       b_AllOpt01C,b_AllOpt02A,
                       type="text",
                       digits=2)


```

Expectations are not met - percent PBSC has a statistically significant, strongly negative, effect in both models.


### 02B: No.Office PSC History
Expectation: The increasing share of contracting office obligations for a given service indicates high capcaity in that area, so we expect the likelihood of both some options being exercised and all options being exercised to increase.

```{r Model02B}

summary_continuous_plot(serv_opt,metric="opt","office_psc_obligatedamount_7year",bins=100)
summary_continuous_plot(serv_opt,metric="opt","office_psc_obligatedamount_7year",bins=100,log=TRUE)

#Model
b_SomeOpt02B <- glm (data=serv_opt,
                 b_SomeOpt ~ cp_OffPSC7, family=binomial(link="logit"))

b_AllOpt02B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cp_OffPSC7)

#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt01C,b_SomeOpt02A,b_SomeOpt02B,
                       b_AllOpt01C,b_AllOpt02A,b_AllOpt02B,
                       type="text",
                       digits=2)


```

Expectations are not met.  In the SomeOpt model, cp_OffPSC7 has a non-statistically negative effect, while in the AllOpt model, it has a very strong negative, statistically significant, effect.


### 02C: Office Capacity
Expectation: Collectively, the larger share of PBSC and contracting office obligations for a given service, we expect the likelihood of both some options being exercised and all options being exercised to increase.

```{r Model02C}


#Model
b_SomeOpt02C <- glm (data=serv_opt, family=binomial(link="logit"),
                 b_SomeOpt ~ cp_OffPerf7+cp_OffPSC7)
glmer_examine(b_SomeOpt02C)

b_AllOpt02C <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cp_OffPerf7+cp_OffPSC7)

glmer_examine(b_AllOpt02C)

#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt01C,b_SomeOpt02A,b_SomeOpt02B,b_SomeOpt02C,
                       type="text",
                       digits=2)


stargazer::stargazer(b_AllOpt01C,b_AllOpt02A,b_AllOpt02B,b_AllOpt02C,
                       type="text",
                       digits=2)



summary_residual_compare(b_SomeOpt02A,b_SomeOpt02C,b_SomeOpt02A,b_AllOpt02B)


```
For the SomeOpt model, the residual plot is wonky (smooth downward concave curve), so we may want to show some concern about the validity of the given result.  For the SomeOpt model, some expectations are now met when these variables are specified together - percent PBSC still has a statistically significant negative effect, but cp_OffPSC7 now flips to statistically significant and positive, as initially expected.

For the AllOpt model, expectations are uniformly violated, though percent PBSC is no longer statistically significant (still negative though), and cp_OffPSC7 remains statistically significant and strongly negative.


### 02D: Cumulative  Model
Expectation: When all the four variables are combined into one model, same expectations are applied as individual ones. Per service complexity indicator increase, we expect the likelihood of both some options being exercised and all options being exercised to decrease. Per office capacity indicator increase, we expect the likelihood of both some options being exercised and all options being exercised to increase.

```{r Model02D}


#Model
b_SomeOpt02D <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_US6sal + cln_PSCrate+ cp_OffPerf7+cp_OffPSC7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt02D)

b_AllOpt02D <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_US6sal + cln_PSCrate+ cp_OffPerf7+cp_OffPSC7)

glmer_examine(b_AllOpt02D)
#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt01C,b_SomeOpt02C,b_SomeOpt02D,
                       
                       b_AllOpt01C,b_AllOpt02C,b_AllOpt02D,
                       type="text",
                       digits=2)



summary_residual_compare(b_SomeOpt02C,b_SomeOpt02D,
                         b_AllOpt02C,b_AllOpt02D)

```
In the SomeOpt model, all expectations are violated except for cp_OffPSC7, which is positive and statistically significant, as expected.  All other variables display negative relationships, though only the invoice rate and percent PBSC are statistically significant as well.

In the AllOpt model, all expecatations are violated except for average salary, which now displays a positive and statistically significant relationship, as originally expected.  All other variables display negative relationships, though the invoice rate's effect is no longer statistically significant.  The effect of cp_OffPSC7 is particularly strong in magnitude (and is negative + stat. sig.).


## Office-Vendor Relationship

### 03A: Pair History
Expactation: As the number of past years of the relationship between the contracting office or the contractors with a single transaction in a given fiscal year enough to qualify, namely, pair history increases, we expect the likelihood of both some options being exercised and all options being exercised to increase.

```{r Model03A}

summary_discrete_plot(serv_opt,metric="opt","cn_PairHist7")


#Model
b_SomeOpt03A <- glm (data=serv_opt,
                 b_SomeOpt ~ cn_PairHist7, family=binomial(link="logit"))


b_AllOpt03A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cn_PairHist7)


#Plot residuals versus fitted
  stargazer::stargazer(b_SomeOpt02D,b_SomeOpt03A,
                       
                       b_AllOpt02D,b_AllOpt03A,
                       type="text",
                       digits=2)



```
Expectations are violated in both models.


### 03B: Paired Actions
Expectation: As the number of contract actions a vendor has performed for an office in the past year increases (decreases), we expect the likelihood of both some options being exercised and all options being exercised to increase.

```{r Model03B}

summary_continuous_plot(serv_opt,metric="opt","cln_PairCA")

#Model
b_SomeOpt03B <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_PairCA, family=binomial(link="logit"))


b_AllOpt03B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_PairCA)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt02D,b_SomeOpt03A,b_SomeOpt03B,
                       
                       b_AllOpt02D,b_AllOpt03A,b_AllOpt03B,
                       type="text",
                       digits=2)


```

Expectations are violated in both models.  Moreover, redisual plot for AllOpt model is questioanble (downward sloping straight line), and so we might want to question the validity of the result for this model.

### 03C: Office-Vendor Relationship
Expectation: 
The importance of partnership, trust, and handling difficult problems and uncertainty together naturally lead into the last characteristic: the relationship between the contractor and buyer. The higher level of interaction provides the more opportunity to build a deeper relationship, we expect the likelihood of both some options being exercised and all options being exercised to increase.

```{r Model03C}

#Model
b_SomeOpt03C <- glm (data=serv_opt,
                 b_SomeOpt ~ cn_PairHist7+cln_PairCA, family=binomial(link="logit"))
glmer_examine(b_SomeOpt03C)

b_AllOpt03C <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cn_PairHist7+cln_PairCA)

glmer_examine(b_AllOpt03C)

#Plot residuals versus fitted
  stargazer::stargazer(b_SomeOpt03A,b_SomeOpt03B,b_SomeOpt03C,
                       
                       b_AllOpt03A,b_AllOpt03B,b_AllOpt03C,
                       type="text",
                       digits=2)



summary_residual_compare(b_SomeOpt03A,b_SomeOpt03C,b_SomeOpt03B,b_SomeOpt03C)
summary_residual_compare(b_AllOpt03A,b_AllOpt03C,b_AllOpt03B,b_AllOpt03C)

```

Expectations are now partially me tin both models.  In both the SomeOpt and AllOpt model, pair history flips to displaying a positive, stat. sig. effect.  However, contract actions pair history remains negative and statistically significant.  In the AllOpt model case, it is very strongly negative.


### 03D: Cumulative  Model

Expectation: Under each subgroup, the predictors are expected to have similar impacts on dependent variables individually and cumulatively:
1. Higher Services Complexity: we expect the likelihood of both some options being exercised and all options being exercised to decrease
2. Larger Office Capacity: we expect the likelihood of both some options being exercised and all options being exercised to increase
3. Deeper Office-Vendor Relationship: we expect the likelihood of both some options being exercised and all options being exercised to increase

```{r Model03D}

#Model
b_SomeOpt03D <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA, family=binomial(link="logit"))
b_SomeOpt03Dv2 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+
                 cn_PairHist7+cln_PairCA, family=binomial(link="logit"))
b_SomeOpt03Dv3 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt03D)
glmer_examine(b_SomeOpt03Dv2)
glmer_examine(b_SomeOpt03Dv3)
stargazer::stargazer(b_SomeOpt03Dv2, b_SomeOpt03Dv3, type = "text", digits = 2)

b_AllOpt03D <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7 + cp_OffPSC7+
                 cn_PairHist7+cln_PairCA)
b_AllOpt03Dv2 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7 + 
                 cn_PairHist7+cln_PairCA)
b_AllOpt03Dv3 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7 + cp_OffPSC7+
                 cn_PairHist7)

glmer_examine(b_AllOpt03D)
glmer_examine(b_AllOpt03Dv2)
glmer_examine(b_AllOpt03Dv3)
stargazer::stargazer(b_AllOpt03Dv2, b_AllOpt03Dv3, type = "text", digits = 2)

#Plot residuals versus fitted   

stargazer::stargazer(b_SomeOpt02D,b_SomeOpt03C,b_SomeOpt03D,
                       b_AllOpt02D,b_AllOpt03C,b_AllOpt03D,
                       type="text",
                       digits=2)


summary_residual_compare(b_SomeOpt03C,b_SomeOpt03D,b_SomeOpt02D,b_SomeOpt03D)
summary_residual_compare(b_AllOpt03C,b_AllOpt03D,b_AllOpt02D,b_AllOpt03D)

```
In both models, cln_PairCA (contract actions pair history) has an unacceptably high VIF: 2.31 in the SomeOpt model, and 2.18 in the AllOpt model.

For SomeOpt, we then create a new model including cln_PairCA, but dropping the variable with the second highest VIF score in the initial b_SomeOpt03D model, cp_OffPSC7.  In this model, b_SomeOpt03Dv2, all VIF scores are acceptable.  Similarly, we create another model, b_SomeOpt03Dv3, which includes all varibles except cln_PairCA, which again features acceptable VIF scores.  However, the AIC score of b_SomeOpt03Dv2 is lower than that of the model which does not include cln_PairCA, so we select b_SomeOpt03Dv2 as our operative model, and discuss the results here (i.e. we drop cp_OffPSC7 to avoid multicollinearity).  Results:
  (1) Higher service complexity variables - only invoice rate matches expectations, while average salary displays a positive and statistically significant effect.
  (2) Office capacity variables - percent PBSC does not meet expectations, as it shows a statistically significant, negative relationship.
  (3) Deeper office-vendor relationship variables - only pair history meets expectations, as contract actions pair history displays a statistically significant, strongly negative relationship.

A similar procedure is adopted for AllOpt, where again cp_OffPSC7 is dropped in model v2, whereas model v3 is a full specification not including cln_PairCA.  In both models, VIF scores are acceptable following drops, and again, model v2 displays a lower AIC score than model v3, and is so retained for our analysis.  Results:
  (1) Higher service complexity variables - no expectations met.  Average salary demonstrates a positive, stat. sig. effect.
  (2) Office capacity variables - percent PBSC does not meet expectations, as it shows a statistically significant, negative relationship.
  (3) Deeper office-vendor relationship variables - only pair history meets expectations, as contract actions pair history displays a statistically significant, negative relationship.

## Study Variables Alone

```{r StudyVariableAlone}


 study_coef_list<-get_coef_list(limit="services")

all_coef_list<-get_coef_list()

 
 
 
 
 


#Ceiling Breaches Binary
  stargazer::stargazer(b_SomeOpt01A,b_SomeOpt01B,b_SomeOpt02A,b_SomeOpt02B,b_SomeOpt03A,b_SomeOpt03B,b_SomeOpt03D,
                       type="text",
                       digits=2)



texreg::htmlreg(list(b_SomeOpt01A,b_SomeOpt01B,b_SomeOpt02A,b_SomeOpt02B,b_SomeOpt03A,b_SomeOpt03B,b_SomeOpt03D),file="..//Output//b_SomeOptModel.html",
                single.row = TRUE,
                # custom.model.name=c("Ceiling Breaches"),
                stars=c(0.1,0.05,0.01,0.001),
                #groups = list(
                #              "Services Complexity" = 2:3,
                #              "Office Capacity" =4:5,
                #              "Past Relationship"=6:7
                #              ),
                custom.coef.map=all_coef_list,
                bold=0.05,
                custom.note="%stars. Numerical inputs are rescaled.",
                caption="Table 6: Logit Bivariate Look at Study Variables and Ceiling Breaches",
                caption.above=TRUE)




#Ceiling Breach Absolute
stargazer::stargazer(b_AllOpt01A,b_AllOpt01B,b_AllOpt02A,b_AllOpt02B,b_AllOpt03A,b_AllOpt03B,b_AllOpt03D,
                       type="text",
                       digits=2)


texreg::htmlreg(list(b_AllOpt01A,b_AllOpt01B,b_AllOpt02A,b_AllOpt02B,b_AllOpt03A,b_AllOpt03B,b_AllOpt03D),file="..//Output//b_AllOptModel.html",
                single.row = TRUE,
                # custom.model.name=c("Ceiling Breaches"),
                stars=c(0.1,0.05,0.01,0.001),
                #groups = list(
                #              "Services Complexity" = 2:3,
                #              "Office Capacity" =4:5,
                #              "Past Relationship"=6:7
                #              ),
                custom.coef.map=all_coef_list,
                bold=0.05,
                custom.note="%stars. Numerical inputs are rescaled.",
                caption="Table 8: Regression Bivariate Look at Study Variables and Log(Options Growth)",
                caption.above=TRUE)





```

# Controls

##Contract-Level Controls
###Scope Variables
#### 04A: Cost Ceiling

Expectation: Initial Ceiling size positively estimates the probability of some options being exercised, while it should negatively estimate all otpions exercised.  Reasoning for this is straightforward: a higher initical ceiling indicates more options to be exercised/anticipated at contract start, which provides some indication that at least one option will be exercised, but equally means it is less likely for them all to be exercised purely for size reasons. 


```{r Model04A}

#Likelihood Plot for unlogged ceiling
summary_continuous_plot(serv_opt,metric="opt","UnmodifiedCeiling_OMB20_GDP18",bins=1000)
summary_continuous_plot(serv_opt,metric="opt","UnmodifiedCeiling_OMB20_GDP18",bins=50,log=TRUE)


#Model
b_SomeOpt04A <- glm (data=serv_opt,
                 b_SomeOpt ~ cl_Ceil, family=binomial(link="logit"))

b_AllOpt04A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cl_Ceil)

#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt03D,b_SomeOpt04A,
                       
                       b_AllOpt03D,b_AllOpt04A,
                       type="text",
                       digits=2)

```
Expectations are met only for the SomeOpt model, as initial ceiling size displays a stat. sig., positive relationship in both models (violated expectations for the AllOpt model).  However, residual plot is wonky for AllOpt model (it appears quasi-sinusoidal), indicating we should be concerned about the validity of the AllOpt result.


#### 04B: Maximum Duration

Expectation: greater maximum duration is expected to positively estimate both b_SomeOpt and b_AllOpt.

```{r Model04B}
#Likelihood Plot for max duration
freq_continuous_cbre_plot(serv_opt,"UnmodifiedDays",
               bins=1000)

summary_continuous_plot(serv_opt,metric="opt","cln_Days")


#Model
b_SomeOpt04B <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Days, family=binomial(link="logit"))

b_AllOpt04B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Days)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt03D,b_SomeOpt04A,b_SomeOpt04B,
                       
                       b_AllOpt03D,b_AllOpt04A,b_AllOpt04B,
                       type="text",
                       digits=2)

```

Expectations only met for SomeOpt model.  AllOpt model displays a very slightly negative relationship, but it is not statistically significant.

####04C: Ratio Initial Ceiling : Base Ratio (Logged)


Expectation, in combination with ceiling, a high ratio means that the contract has more room for adjustment and incentives without radical steps. For exercised options, a higher ratio is expected to make it more likely that some options are exercised but less likely that all options are exercised.
```{r Model04C}
summary_continuous_plot(serv_opt,metric="opt", "clr_Ceil2Base")

#Model


#Model
b_SomeOpt04C <- glm(data=serv_opt, b_SomeOpt ~ clr_Ceil2Base,family=binomial(link="logit"))

b_AllOpt04C <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ clr_Ceil2Base)


#Plot Residuals vs. Fitted
stargazer::stargazer(b_SomeOpt04A,b_SomeOpt04B,b_SomeOpt04C,
                     b_AllOpt04A,b_AllOpt04B,b_AllOpt04C, type="text", digits=2)



```
Expectations are met.

#### 04D: Ceiling-Days-Ratio

```{r Model04D}

#Model
b_SomeOpt04D <- glm (data=serv_opt,
                 b_SomeOpt ~ cl_Ceil + cln_Days + clr_Ceil2Base, family=binomial(link="logit"))
glmer_examine(b_SomeOpt04D)

b_AllOpt04D <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~cl_Ceil + cln_Days + clr_Ceil2Base)

glmer_examine(b_AllOpt04D)
#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt04A,b_SomeOpt04B,b_SomeOpt04C,b_SomeOpt04D,
                       type="text",
                       digits=2)
stargazer::stargazer(b_AllOpt04A,b_AllOpt04B,b_AllOpt04C,b_AllOpt04D,
                       type="text",
                       digits=2)


summary_residual_compare(b_SomeOpt04A,b_SomeOpt04D,b_SomeOpt04B,b_SomeOpt04D)
summary_residual_compare(b_AllOpt04A,b_AllOpt04D,b_AllOpt04B,b_AllOpt04D)
```
SomeOpt: Expectations met.
AllOpt: Some expectations met.  Ceiling to base ratio displays the expected negative, stat. significant, relationship.  However, initial ceiling size displays a postive, statistically significant effect (though only at the 10% level), and maximum contract length displays a statistically significant negative effect, both of which violate expectations.

#### 04E: Base
Expectation: higher base estimates a higher probability of b_SomeOpt, as larger projects have more momentum.
We weakly expect a higher base to estimate a lower probability of b_AllOpt.
```{r Model04E}

#Likelihood Plot for unlogged ceiling
summary_continuous_plot(serv_opt,metric="opt","UnmodifiedBase_OMB20_GDP18",bins=1000)
summary_continuous_plot(serv_opt,metric="opt","UnmodifiedBase_OMB20_GDP18",bins=50,log=TRUE)



#Model
b_SomeOpt04E <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Base, family=binomial(link="logit"))

b_AllOpt04E <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Base)

#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt03D,b_SomeOpt04A,b_SomeOpt04E,
                       b_AllOpt03D,b_AllOpt04A,b_AllOpt04E,
                       type="text",
                       digits=2)

#Including residual compare for base and counterpart ceiling
summary_residual_compare(b_SomeOpt04A,b_SomeOpt04E)
summary_residual_compare(b_AllOpt04A,b_AllOpt04E)


```
Expectations are met for b_SomeOpt, but not for b_AllOpt.

#### 04F: Base-Days-Ratio

```{r Model04F}

#Model
b_SomeOpt04F <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Base+ cln_Days + clr_Ceil2Base, family=binomial(link="logit"))


b_AllOpt04F <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~cln_Base + cln_Days  + clr_Ceil2Base)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt04D,b_SomeOpt04E,b_SomeOpt04F,
                       
                       b_AllOpt04D,b_AllOpt04E,b_AllOpt04F,
                       type="text",
                       digits=2)



summary_residual_compare(b_SomeOpt04A,b_SomeOpt04F,b_SomeOpt04B,b_SomeOpt04F)
summary_residual_compare(b_AllOpt04A,b_AllOpt04F,b_AllOpt04B,b_AllOpt04F)
```
SomeOpt: Expectations met for days, ceiling to base ratio, and base itself.
AllOpt: Expectations not met for all variables.

#### 04G: Cumulative  Model

```{r Model04G}

#Model
b_SomeOpt04G <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days, family=binomial(link="logit"))
b_SomeOpt04Gv2 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days, family=binomial(link="logit"))
b_SomeOpt04Gv3 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7 +
                   cln_Base + clr_Ceil2Base + cln_Days, family=binomial(link="logit"))
glmer_examine(b_SomeOpt04G)
glmer_examine(b_SomeOpt04Gv2)
glmer_examine(b_SomeOpt04Gv3)
stargazer::stargazer(b_SomeOpt04Gv2, b_SomeOpt04Gv3, type = "text", digits = 2)

b_AllOpt04G <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7 + cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days)

glmer_examine(b_AllOpt04G)

#Plot residuals versus fitted   

stargazer::stargazer(b_SomeOpt03D,b_SomeOpt04F,b_SomeOpt04G,
                       
                       b_AllOpt03D,b_AllOpt04F,b_AllOpt04G,
                       type="text",
                       digits=2)


summary_residual_compare(b_SomeOpt03D,b_SomeOpt04G)
summary_residual_compare(b_AllOpt03D,b_AllOpt04G)


```
AllOpt: VIF score and residual plot acceptable.  Results:
  (1) Higher service complexity variables - invoice rate displays a negative, stat. sig., relationship, meeting expectations..  Average salary demonstrates a positive, stat. sig. effect.
  (2) Office capacity variables - neither variable meets expectations (though percent PBSC's negative effect is now no longer statistically significant).
  (3) Deeper office-vendor relationship variables - only pair history meets expectations, as contract actions pair history displays a statistically significant, negative relationship.
  (4) Control variables - No variables meet expectations
  
SomeOpt: VIF score of cln_PairCA unnaceptably high.  Two alternative models are created, b_SomeOpt04Gv2 and v3.  Model v2 drops cp_OffPSC7, the IV with the second highest VIF in model b_SomeOpt04.  Model v3 is a full specification without cln_PairCA.  VIF levels are acceptable for all variables in both model v2 and model v3.  AIC is lower for model v2, and so is selected for our analysis (i.e. we do our analysis with a model that drops cp_OffPSC7 and retains cln_PairCA).  Results:
  (1) Higher service complexity variables - expectations met for both variables
  (2) Office capacity variables - Percent PBSC does not meet expectations, as it displays a statiscally significant, negative relationship.
  (3) Deeper office-vendor relationship variables - only pair history meets expectations, as contract actions pair history displays a statistically significant, negative relationship.
  (4) Control variables - All variables meet expectations.


### Competition
#### 05A: No Competition / 1 / 2-4 / 5+ Offers
No competition (baseline) and single offer competition  is expected to estimate lower probabilities for both b_SomeOpt and b_AllOpt.

Multioffer competition is expected to lead to a higher probability of both b_SomeOpt and b_AllOpt for 2-4 options, but the opposite (i.e. lower probabilities for both) for 5+ as the diversity of competitors available may raise the appeal of going with a new contract rather than more options, especially if performance is below the desired level.

```{r Model05A}
summary_discrete_plot(serv_opt,metric="opt","Comp")


#Model
b_SomeOpt05A <- glm (data=serv_opt,
                 b_SomeOpt ~ Comp, family=binomial(link="logit"))


b_AllOpt05A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ Comp)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt04G,b_SomeOpt05A,
                       
                       b_AllOpt04G,b_AllOpt05A,
                       type="text",
                       digits=2)




```
Expectations met for 1 offer binary.
Expectations not met for 2-4 offer binary - displays a statistically significant, negative relationship in both models.
Expectations met for 5+ offer binary (displays a stat. significant, negative relationship in both models).

#### 05B: Cumulative  Model

```{r Model05B}

#Model
b_SomeOpt05B <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp, family=binomial(link="logit"))
b_SomeOpt05Bv2 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp, family=binomial(link="logit"))
b_SomeOpt05Bv3 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7 +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp, family=binomial(link="logit"))
glmer_examine(b_SomeOpt05B)
glmer_examine(b_SomeOpt05Bv2)
glmer_examine(b_SomeOpt05Bv3)

stargazer::stargazer(b_SomeOpt05Bv2, b_SomeOpt05Bv3, type = "text", digits = 2)

#Is it safe to add pPBSC back in?

b_AllOpt05B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp)

glmer_examine(b_AllOpt05B)

#Plot residuals versus fitted   

stargazer::stargazer(b_SomeOpt04G,b_SomeOpt05A,b_SomeOpt05B,
                       
                       b_AllOpt04G,b_AllOpt05A,b_AllOpt05B,
                       type="text",
                       digits=2)

 
summary_residual_compare(b_SomeOpt04G,b_SomeOpt05B)
summary_residual_compare(b_AllOpt04G,b_AllOpt05B)


```
AllOpt: VIF acceptable, residual plots acceptable.  Results:
  (1) Higher service complexity variables - invoice rate displays a negative, stat. sig., relationship, meeting expectations.  Average salary does not meet expectations.
  (2) Office capacity variables - neither variable meets expectations (though percent PBSC's negative effect is still not statistically significant).
  (3) Deeper office-vendor relationship variables - only pair history meets expectations, as contract actions pair history displays a statistically significant, negative relationship.
  (4) Control variables (base, ceiling to base ratio, maximum contract length) - No variables meet expectations
  (5) Number of offers variables - only Comp5+ offers meets expectations, the two other competition binaries do not have statistically significant effects.
  
SomeOpt: VIF of cln_PairCA unnaceptable.  Two alternative models are created, b_SomeOpt04Gv2 and v3.  Model v2 drops cp_OffPSC7, the IV with the second highest VIF in model b_SomeOpt04.  Model v3 is a full specification without cln_PairCA.  VIF levels are acceptable for all variables in both model v2 and model v3.  AIC is lower for model v2, and so is selected for our analysis.  Results:
  (1) Higher service complexity variables - expectations met for both variables
  (2) Office capacity variables - Percent PBSC does not meet expectations, as it displays a statiscally significant, negative relationship.
  (3) Deeper office-vendor relationship variables - only pair history meets expectations, as contract actions pair history displays a statistically significant, negative relationship.
  (4) Control variables (base, ceiling to base ratio, maximum contract length) - All variables meet expectations.
  (5) Number of offers variables - Comp1 offer and Comp5+ offer meet expectations.  Comp2-4 offers does not, as it displays a statistically significant, negative relationship.


### Contract Vehicle

#### 06A: Def/Pur; S-IDC; M-IDC; FSS-GWAC; BPA-BOA.

Expectation: Indefinite delivery vehicles, means that the government has an existing relationship with the vendor and administration is easier. The downside is that the government may be locked into the vendor. Excerised options not straightforward to puzzle through, but we expect a negative relationship as all forms of IDVs make it easier to use a new task order and thus may both reduce the need to exercise options and may allow new work to flow into a different contract rather than prompting a breach.


```{r Model06A}

summary_discrete_plot(serv_opt,metric="opt","Veh")


#Model
b_SomeOpt06A <- glm (data=serv_opt,
                 b_SomeOpt ~ Veh, family=binomial(link="logit"))


b_AllOpt06A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ Veh)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt05B,b_SomeOpt06A,
                       
                       b_AllOpt05B,b_AllOpt06A,
                       type="text",
                       digits=2)




```
For ceiling breaches, IDCs, particularly multiaward IDCs, had a greater likelihood of  ceiling breaches contrary to expecations. For size the results were similarly mixed, with single award IDCS and BPA/BOAs estimating smaller  breaches in line with expetations and Mutiple Award and FSS/GWAC estimated larger breaches, contrary to expectation.

SomeOpt: VehS-IDC and VehBPA/BOA meet expectations.  Multiple award IDCs and FSS/GWAC vehicles both violate expectations, demonstrating statistically significant, positive relationships.

AllOpt: VehS-IDC, VehM-IDC, and VehBPA/BOA meet expectations.  FSS/GWAC vehicles do not meet expectations, but the positive effect they display is not statistically significant.


#### 06B: Cumulative  Model

```{r Model06B}

#Model
b_SomeOpt06B <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh, family=binomial(link="logit"))
b_SomeOpt06Bv2 <- glm (data=serv_opt,
                 b_SomeOpt ~ 
                   cln_PSCrate+ cp_OffPerf7+
                 cn_PairHist7 + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh, family=binomial(link="logit"))
glmer_examine(b_SomeOpt06B)
glmer_examine(b_SomeOpt06Bv2)

b_AllOpt06B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh)
b_AllOpt06Bv2 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~   
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh)
glmer_examine(b_AllOpt06B)
glmer_examine(b_AllOpt06Bv2) #Fine with cln_US6sal and cln_PairCA dropped

#Plot residuals versus fitted   

stargazer::stargazer(b_SomeOpt05B,b_SomeOpt06A,b_SomeOpt06B,
                       b_AllOpt05B,b_AllOpt06A,b_AllOpt06B,
                       type="text",
                       digits=2)


summary_residual_compare(b_SomeOpt05B,b_SomeOpt06B,bins=50)
summary_residual_compare(b_AllOpt05B,b_AllOpt06B,bins=50)


```
[Deprecated] VIF score of vehicle in both models is unnaceptably large.  In order to reduce this to an acceptable level, a number of study variables would have to be dropped from the model, which the team found to be unacceptable.  Thus, vehicle is not included as a control in our cumulative model. [/Deprecated]

The above was a mistake - rescaled GVIF is acceptable, and vehicle will be included as a control in our model - though at some points in the next several sections, it will not be, as a holdover from its prior removal.

### Type of Contract

The next step adds a measure for whether the contract was cost-based or fixed-price. 

Expectation - prior CSIS research has found that fixed-price contracts estimate a higher probability of terminations but did not find a notable relationship for ceiling breaches.

#### 07A: FFP / Other FP / Incentive / T&M/FP:LOE;LH / Other CB / Combination

Firm-fixed price contracting is expected to be associated with a higher rate of options exercised, under both model specifications.

(Options, breach, termination)
Firm-Fixed Price (base)				+	+	++
Other Fixed Price				-	-	-
Time & Materials / Labor Hours / FP: LoE				-	+	-
Incentive Fee (both FPIF or CBIF)				+	-	-
Other Cost Based				-	-	-
Undefinitized Contract Award				--	++	++
Combination				-	+	+


```{r Model07A}
serv_opt$Pricing<-factor(serv_opt$Pricing,
                            levels=c( "FFP","Other FP","T&M/LH/FPLOE","Incentive","Other CB","UCA" ,"Combination or Other" ))
serv_opt$Pricing<-factor(serv_opt$Pricing,
                            levels=c( "FFP","Other FP","T&M/LH/FPLOE","Incentive","Other CB","UCA" ,"Combination or Other" ))
  summary_discrete_plot(serv_opt,metric="opt","Pricing")



#Model
b_SomeOpt07A <- glm (data=serv_opt,
                 b_SomeOpt ~ Pricing, family=binomial(link="logit"))


b_AllOpt07A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ Pricing)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt06B,b_SomeOpt07A,
                       
                       b_AllOpt06B,b_AllOpt07A,
                       type="text",
                       digits=2)


```
For firm-fixed priced contracts, expectations are not met for both models (statistically significant negative relationship, where a positive relationship was expected).

For time and materials/labour hours/FP:LoE, expectations are not met (statistically significant positive relationship displayed) for both models.

For incentive-based contracts, expectations are met for both models.

For other cost-based pricing, expectations are not met for both models.

For undefinitized contract award-pricing, expectations are not met for both models, though a non-statistically significant negative relationship is displayed for the AllOpt model.

For combination-based pricing, expectations are not met for both models.


#### 07B: Cumulative  Model

```{r Model07B}

#Model
b_SomeOpt07B <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Pricing, family=binomial(link="logit"))
b_SomeOpt07Bv2 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Pricing, family=binomial(link="logit"))
b_SomeOpt07Bv3 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Pricing, family=binomial(link="logit"))
glmer_examine(b_SomeOpt07B)
glmer_examine(b_SomeOpt07Bv2)
glmer_examine(b_SomeOpt07Bv3)

b_AllOpt07B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Pricing)

glmer_examine(b_AllOpt07B)

#Plot residuals versus fitted   

stargazer::stargazer(b_SomeOpt06B,b_SomeOpt07A,b_SomeOpt07Bv3,
                       
                       b_AllOpt06B,b_AllOpt07A,b_AllOpt07B,
                       type="text",
                       digits=2)


summary_residual_compare(b_SomeOpt06B,b_SomeOpt07Bv3,bins=50)
summary_residual_compare(b_AllOpt06B,b_AllOpt07B,bins=50)

```

AllOpt: VIF scores acceptable, residual plots within tolerance.  Results:
  (1) Higher service complexity variables - invoice rate displays a negative, stat. sig., relationship, meeting expectations.  Average salary does not meet expectations.
  (2) Office capacity variables - neither variable meets expectations (though percent PBSC's negative effect is only significant at the 5% level).
  (3) Deeper office-vendor relationship variables - only pair history meets expectations, as contract actions pair history displays a statistically significant, negative relationship.
  (4) Control variables (base, ceiling to base ratio, maximum contract length) - No variables meet expectations (and cln_Ceil2Base and cln_Days display statistically significant negative effects)
  (5) Number of offers variables - only Comp5+ offers meets expectations, while comp2-4 offers displays a statistically significant negative effect, the opposite of what was expected.
  (6) Pricing - For incentive-based contracts, expectations were met. They were not met for any other pricing variable - i.e.: For firm-fixed priced contracts, expectations were not met.  For time and materials/labour hours/FP:LoE, expectations are not met. For other cost-based pricing, expectations were not met.  For undefinitized contract award-pricing, expectations were not met.

SomeOpt: VIF score for cln_PairCA unacceptable.  Given that vehicle cannot be included as a control in this model, this document will assume that cln_PairCA is always going to have a multi-collinearity problem.  Following from the results of the analysis done when this problem has occurred in previous sections, we drop cp_OffPSC7 in b_SomeOpt07Bv2.  However, the VIF of cln_PairCA is still unacceptable.  In order to bring it within tolerance, we would have to drop a second study variable from our model, which, given that cln_PairCA violates our expectations and we were borderline between keeping it and retaining it when we only had to drop one explanatory variable, indicates that we should instead drop cln_PairCA.  This is done in b_SomeOptBv3, and will be done for the rest of the cumulative model specifications in this document for the b_SomeOpt models.  VIF is thus fine, residauls are slightly wonky, but tolerable, and so results:
  (1) Higher service complexity variables - expectations met for both variables
  (2) Office capacity variables - Only cp_OffPSC7 meets expectations.
  (3) Deeper office-vendor relationship variables -  pair history meets expectations (only variable in this category now)
  (4) Control variables (base, ceiling to base ratio, maximum contract length) - All variables meet expectations.
  (5) Number of offers variables - Comp1 offer and Comp5+ offer meet expectations.  Comp2-4 offers does not, as it displays a statistically significant, negative relationship.
  (6) Pricing - For incentive-based contracts, expectations were met. They were not met for any other pricing variable - i.e.: For firm-fixed priced contracts, expectations were not met.  For time and materials/labour hours/FP:LoE, expectations are not met. For other cost-based pricing, expectations were not met.  For undefinitized contract award-pricing, expectations were not met.


### Crisis Dataset
Expectation: Service Contract replying on crisis funds would have more likelihood of b_SomeOpt, but a lower likelihood of b_AllOpt.
#### 08A: Crisis Funding
```{r Model08A}
summary_discrete_plot(serv_opt,metric="opt","Crisis")


#Model
b_SomeOpt08A <- glm (data=serv_opt,
                 b_SomeOpt ~ Crisis, family=binomial(link="logit"))


b_AllOpt08A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ Crisis)



#Plot residuals versus fitted
#stargazer::stargazer(b_SomeOpt07B,b_SomeOpt08A,b_AllOpt07B,b_AllOpt08A,type="text",digits=2)
stargazer::stargazer(b_SomeOpt08A, b_AllOpt08A, type = "text", digits = 2)

```
SomeOpt: No expectations met
AllOpt: CrsisiDis and CrisisOCO both meet expectations, though CrisisDIS is only statistically significant at the 10% level.


#### 08B: Cumulative  Model

```{r Model08B}

#Model
b_SomeOpt08B <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7 +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Pricing+
                   Crisis, family=binomial(link="logit"))
glmer_examine(b_SomeOpt08B)

b_AllOpt08B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Pricing+
                   Crisis)
b_AllOpt08Bv2 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Pricing+
                   Crisis)
glmer_examine(b_AllOpt08B)
glmer_examine(b_AllOpt08Bv2)

#Plot residuals versus fitted   



stargazer::stargazer(b_SomeOpt07B,b_SomeOpt08A,b_SomeOpt08B,
                       
                       b_AllOpt07B,b_AllOpt08A,b_AllOpt08Bv2,
                       type="text",
                       digits=2)

summary_residual_compare(b_SomeOpt07B,b_SomeOpt08B,bins=50)
summary_residual_compare(b_AllOpt07B,b_AllOpt08B,bins=50)

```
AllOpt - at this point, cln_PairCA has an unacceptably high VIF.  Given the borderline nature of deciding to drop cln_PairCA vs cp_OffPSC7, I decide to drop cln_PairCA to stay in sync with the SomeOpt model.  This will be done for all future model specifications of the AllOpt model, and is done here as b_AllOpt08Bv2.  Residuals are acceptable, as are the VIF scores of this new model.  Results:
  (1) Higher service complexity variables - invoice rate displays a negative, stat. sig., relationship, meeting expectations.  Average salary does not meet expectations.
  (2) Office capacity variables - neither variable meets expectations (though percent PBSC's negative effect is only significant at the 5% level).
  (3) Deeper office-vendor relationship variables - pair history does not meet expectations.
  (4) Control variables (base, ceiling to base ratio, maximum contract length) - No variables meet expectations (and cln_Ceil2Base and cln_Days display statistically significant negative effects)
  (5) Number of offers variables - only Comp5+ offers meets expectations, while comp2-4 offers displays a statistically significant negative effect, the opposite of what was expected.
  (6) Pricing - For incentive-based contracts, expectations were met. They were not met for any other pricing variable - i.e.: For firm-fixed priced contracts, expectations were not met.  For time and materials/labour hours/FP:LoE, expectations are not met. For other cost-based pricing, expectations were not met.  For undefinitized contract award-pricing, expectations were not met.
  (7) Crisis funding -  CrsisiDis and CrisisOCO both meet expectations, though CrisisDIS is only statistically significant at the 10% level. 

SomeOpt - Residuals are borderline, but acceptable.  VIF scores are well within tolerance.  Results:
  (1) Higher service complexity variables - expectations met for both variables
  (2) Office capacity variables - Only cp_OffPSC7 meets expectations.
  (3) Deeper office-vendor relationship variables -  pair history meets expectations (only variable in this category now)
  (4) Control variables (base, ceiling to base ratio, maximum contract length) - All variables meet expectations.
  (5) Number of offers variables - Only Comp5+ meets expectations.  Comp2-4 displays a statistically significant, negative relationship, opposite of expectations.
  (6) Pricing - Expectations only met for PricingUCA, and effect only statistically significant at the 10% level.  Expectations not met for any other pricing variable.

## Industrial Sector

### Level 6

#### Model 09A: cln_Def6HHI
(Options, breach, termination)
HHI (logged, + means more consolidation)	cln_Def6HHI+	-	+	-


Expectation: higher HHI means more consolidation, and thus is more likely to be associated with bad contracting outcomes.  In turn, higher HHI should be associated with lower b_SomeOpt and b_AllOpt.
```{r Model09A}
#Likelihood Plot for unlogged ceiling
summary_continuous_plot(serv_opt,metric="opt","def6_HHI_lag1")
summary_continuous_plot(serv_opt,metric="opt","cln_Def6HHI")
summary_continuous_plot(serv_opt,metric="opt","cln_Def3HHI")


#Model
b_SomeOpt09A <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def6HHI, family=binomial(link="logit"))


b_AllOpt09A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def6HHI)



#Plot residuals versus fitted
#stargazer::stargazer(b_SomeOpt08B,b_SomeOpt09A,b_AllOpt08B,b_AllOpt09A,type="text",digits=2)
stargazer::stargazer(b_SomeOpt09A,b_AllOpt09A,type="text",digits=2)

```

Expectations met.

#### Model 09B: Defense to Overall ratio
The higher the ratio of defense obligations to reciepts in the overall economy, the DoD holds a greater degree of monosopy over a sector. Given the challenges of monosopy, the a higher ratio estimates a higher probability of b_SomeOpt and b_AllOpt.

(Options, breach, termination)
Ratio Def. obligatons : US revenue	cln_Def6Obl+		+	-	-

```{r Model09B}
#Likelihood Plot for unlogged ceiling
      summary_continuous_plot(serv_opt,metric="opt","def6_ratio_lag1")

      summary_continuous_plot(serv_opt,metric="opt","clr_Def6toUS")
      



#Model
b_SomeOpt09B <- glm (data=serv_opt,
                 b_SomeOpt ~ clr_Def6toUS, family=binomial(link="logit"))


b_AllOpt09B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ clr_Def6toUS)


#Plot residuals versus fitted
#stargazer::stargazer(b_SomeOpt08B,b_SomeOpt09A,b_SomeOpt09B,b_AllOpt08B,b_AllOpt09A,b_AllOpt09B,type="text", digits=2)
stargazer::stargazer(b_SomeOpt09A,b_SomeOpt09B,b_AllOpt09A,b_AllOpt09B,type="text", digits=2)



```
Expectations met for AllOpt, but not for SomeOpt, where clr_Def6toUS has a statistically significant, negative effect.

#### Model 09C: Defense Obligations
(Options, breach, termination)
Defense obligations (logged)	clr_Def6toUS+		-	-	+
Expectation: Higher logged defense obligations estimates lower probabilities for both b_SomeOpt and b_AllOpt.
```{r Model09C}
#Likelihood Plot for unlogged ceiling
      summary_continuous_plot(serv_opt,metric="opt","def6_obl_lag1Const")

      summary_continuous_plot(serv_opt,metric="opt","cln_Def6Obl")

#Model
b_SomeOpt09C <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def6Obl, family=binomial(link="logit"))


b_AllOpt09C <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def6Obl)


#Plot residuals versus fitted

stargazer::stargazer(b_SomeOpt09A,b_SomeOpt09B,b_SomeOpt09C, b_AllOpt09A,b_AllOpt09B,b_AllOpt09C,type="text",digits=2)


```

Expectations upheld for all options but not some.

#### Model 09D: NAICS6 6 Combined
Consolidation at less and more granular levels may have different effects. Efficiencies are often used to describe sectors, like utilities, with high barriers to entry. Many of these aspects seem like they would already be captured at less granular NAICS6 levels, e.g. power plants, rather than more specific NAICS6 levels, like solar vs. coal. As a result, consolidation for more granular NAICS6 codes should estimate higher rates of ceiling breaches compared to less granular NAICS6 code.

We'll start by adding in everything from both models and seeing what violates VIF.
```{r Model09D}
#Likelihood Plot for unlogged ceiling



#Model
b_SomeOpt09D <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def6HHI+clr_Def6toUS+cln_Def6Obl
                 , family=binomial(link="logit"))
glmer_examine(b_SomeOpt09D)

b_AllOpt09D <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def6HHI+clr_Def6toUS+cln_Def6Obl)


glmer_examine(b_AllOpt09D)

stargazer::stargazer(b_SomeOpt09A,b_SomeOpt09B,b_SomeOpt09C,b_SomeOpt09D,
                     type="text",digits=2)
stargazer::stargazer(b_AllOpt09A,b_AllOpt09B,b_AllOpt09C,b_AllOpt09D,
                                                                type="text",digits=2)


summary_residual_compare(b_SomeOpt09D, bins=10)
summary_residual_compare(b_AllOpt09D,bins=10)
```

For some options, HHI6 and Def6toUS expectations are upheld, but def6obl are not
For all options, HHI6 and def6 obl expectations are upheld, but def6tous are not.

#### Model 09E: Cumulative Model
Consolidation at less and more granular levels may have different effects. Efficiencies are often used to describe sectors, like utilities, with high barriers to entry. Many of these aspects seem like they would already be captured at less granular NAICS6 levels, e.g. power plants, rather than more specific NAICS6 levels, like solar vs. coal. As a result, consolidation for more granular NAICS6 codes should estimate higher rates of ceiling breaches compared to less granular NAICS6 code.

We'll start by adding in everything from both models and seeing what violates VIF.
```{r Model09E}
#Model
b_SomeOpt09E <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+cln_Def6Obl, family=binomial(link="logit"))
glmer_examine(b_SomeOpt09E)

b_AllOpt09E <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+cln_Def6Obl)

glmer_examine(b_AllOpt09E)

#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt08B,b_SomeOpt09D,b_SomeOpt09E,
                     
                     b_AllOpt08B,b_AllOpt09D,b_AllOpt09E,
                       type="text",
                       digits=2)

summary_residual_compare(b_SomeOpt08B,b_SomeOpt09E,bins=50)
summary_residual_compare(b_SomeOpt08B,b_SomeOpt09E,bins=50)
```
N.B.: Vehicle is now included in model specification
SomeOpt:
Def6HHI - Swapped sign and is now more significant (at 5% level) - opposite of expectations.
Def6toUS - Lost significance
Def6Obl - Lost significance

AllOpt:
Def6HHI - Negative and significant (thought at 10% level), meets expectations
Def6toUS - Positive and significant - meets expectations
Def6Obl - Positive and significant - Opposite of expectations

### Level 3
#### Model 10A: cln_Def3HHI
(Options, breaches, and terminations)
HHI (logged, + means more consolidation)	cln_Def3HHI		TRUE	-	+	++

```{r Model10A}
#Likelihood Plot for unlogged ceiling
summary_continuous_plot(serv_opt,metric="opt","cln_Def3HHI")

#Model
b_SomeOpt10A <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def3HHI, family=binomial(link="logit"))


b_AllOpt10A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def3HHI)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt09A,b_SomeOpt10A,
                       
                       b_AllOpt09A,b_AllOpt10A,
                       type="text",
                       digits=2)

#Summary Residual Compare include for NAICS66 counterparts
summary_residual_compare(b_SomeOpt09A,b_SomeOpt10A, skip_vif =  TRUE)
summary_residual_compare(b_AllOpt09A,b_AllOpt10A, skip_vif =  TRUE)



```

The results for subsector HHI is contrary to expectation for some options but in line with expectations for all options.


#### Model 10B: Defense to Overall ratio
(Options, breaches, and terminations)
Ratio Def. obligatons : US revenue	clr_Def3toUS+		-	+	+

```{r Model10B}
#Likelihood Plot for unlogged ceiling
summary_continuous_plot(serv_opt,metric="opt","capped_def3_ratio_lag1")
summary_continuous_plot(serv_opt,metric="opt","clr_Def3toUS")

#Model
b_SomeOpt10B <- glm (data=serv_opt,
                 b_SomeOpt ~ clr_Def3toUS, family=binomial(link="logit"))


b_AllOpt10B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ clr_Def3toUS)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt09B,b_SomeOpt10A,b_SomeOpt10B,
                       
                       b_AllOpt09B,b_AllOpt10A,b_AllOpt10B,
                       type="text",
                       digits=2)

#Summary Residual Compare include for NAICS66 counterparts
summary_residual_compare(b_SomeOpt09B,b_SomeOpt10B)
summary_residual_compare(b_AllOpt09B,b_AllOpt10B)
```

The results were significantly positive in both cases, though unfortunately contrary to expectations.


#### Model 10C: NAICS6 6 and NAICS6 3
Consolidation at lessa nd more granular levels may have different effects. Efficiencies are often used to describe sectors, like utilities, with high barriers to entry. Many of these aspects seem like they would already be captured at less granular NAICS6 levels, e.g. power plants, rather than more specific NAICS6 levels, like solar vs. coal. As a result, consolidation for more granular NAICS6 codes should estimate higher rates of ceiling breaches compared to less granular NAICS6 code.

We'll start by adding in everything from both models and seeing what violates VIF.
```{r Model10C}


#Model
b_SomeOpt10C <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def6HHI+clr_Def6toUS+cln_Def6Obl+
                   cln_Def3HHI+clr_Def3toUS, family=binomial(link="logit"))
glmer_examine(b_SomeOpt10C)

b_AllOpt10C <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def6HHI+clr_Def6toUS+cln_Def6Obl+
                   cln_Def3HHI+clr_Def3toUS)
glmer_examine(b_AllOpt10C)

#No obl
b_SomeOpt10C2 <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+clr_Def3toUS, family=binomial(link="logit"))
glmer_examine(b_SomeOpt10C2)

b_AllOpt10C2 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+clr_Def3toUS)
glmer_examine(b_AllOpt10C2)

#No HHI6

b_SomeOpt10C3 <- glm (data=serv_opt,
                 b_SomeOpt ~ clr_Def6toUS+cln_Def6Obl+
                   cln_Def3HHI+clr_Def3toUS, family=binomial(link="logit"))
glmer_examine(b_SomeOpt10C3)

b_AllOpt10C3 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ clr_Def6toUS+cln_Def6Obl+
                   cln_Def3HHI+clr_Def3toUS)
glmer_examine(b_AllOpt10C3)


#Model no ratio 3
b_SomeOpt10C4 <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def6HHI+clr_Def6toUS+cln_Def6Obl+
                   cln_Def3HHI, family=binomial(link="logit"))
glmer_examine(b_SomeOpt10C4)

b_AllOpt10C4 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def6HHI+clr_Def6toUS+cln_Def6Obl+
                   cln_Def3HHI)
glmer_examine(b_AllOpt10C4)


#No Obl or subsector ratio
b_SomeOpt10C5 <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI, family=binomial(link="logit"))
glmer_examine(b_SomeOpt10C5)

b_AllOpt10C5 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI)
glmer_examine(b_AllOpt10C5)

#No Obl or detailed industry ratio
b_SomeOpt10C6 <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_Def6HHI+clr_Def6toUS+
                   clr_Def3toUS, family=binomial(link="logit"))
glmer_examine(b_SomeOpt10C6)

b_AllOpt10C6 <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_Def6HHI+clr_Def6toUS+
                   clr_Def3toUS)
glmer_examine(b_AllOpt10C6)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt09D,b_SomeOpt10A,b_SomeOpt10B,b_SomeOpt10C4,b_SomeOpt10C5,b_SomeOpt10C6,
                       type="text",
                       digits=2)

stargazer::stargazer(b_AllOpt09D,#b_AllOpt10A,b_AllOpt10B,
                     b_AllOpt10C2,b_AllOpt10C3,b_AllOpt10C4,b_AllOpt10C5,b_AllOpt10C6,
                       type="text",
                       digits=2)


summary_residual_compare(b_SomeOpt09D,b_SomeOpt10C4,b_SomeOpt10C5,b_SomeOpt10C6,bins=10)
summary_residual_compare(b_AllOpt10C3,b_AllOpt10C4,b_AllOpt10C5,b_AllOpt10C6,bins=10)
```

VIF is becoming a problem, prompting removal of detailed industry oligations for all options, which is captured in part by detailed industry ratio and the more on point measure of DoD experience, office volume. Unfortunately, For some options this was not sufficient to lower VIFs for all options, so defense ratio 3 was also removed.
b_SomeOpt10C5
b_AllOpt10C2

#### Model 10D: Cumulative Model
.
```{r Model10D}
#Likelihood Plot for unlogged ceiling


#Model
b_SomeOpt10D <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days +
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+#clr_Def6Obl+
                   cln_Def3HHI,#+clr_Def3toUS, 
                 family=binomial(link="logit"))
glmer_examine(b_SomeOpt10D)

b_AllOpt10D <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days +
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+cln_Def3HHI+
                   clr_Def3toUS)
glmer_examine(b_AllOpt10D)




#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt09E,b_SomeOpt10C5,b_SomeOpt10D,
                     b_AllOpt09E,b_AllOpt10C2,b_AllOpt10D,
                       type="text",
                       digits=2)

summary_residual_compare(b_SomeOpt09E,b_SomeOpt10D,bins=50)
summary_residual_compare(b_SomeOpt09E,b_SomeOpt10D,bins=50)
```
For some Def6flips signs though remains significant and Def3HHI remains positive, both contrary to exxpectation.

For optall def6HHI and def6toUS lose significance. Def3HHI remains negative, in line with expectaitons while def3toUS is still positive and significant.
## Office 
### Office and Vendor-Office Pair

#### Model 11A: Vendor Market Share
Expectation: Contracts of offices partnered with vendors who have larger market shares would be more likely to experience cost ceiling (++) breaches and some exercised options, but less likely to have terminations and all options. The lrelative lock on the market means that we expect some options will be exercised and there's more of a risk of some breach, but outright termination would be hard on the office. Nonetheless, while there are advantages to using the same contract for the office, a more locked vendor may be less likely to have the competitive drive win all options.

SomeOpt: +
AllOpt: -


```{r Model11A}

summary_continuous_plot(serv_opt,metric="opt","cp_PairObl7")


#Model
b_SomeOpt11A <- glm (data=serv_opt,
                 b_SomeOpt ~ cp_PairObl7, family=binomial(link="logit"))


b_AllOpt11A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cp_PairObl7)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt11A,
                       b_AllOpt11A,
                       type="text",
                       digits=2)



```

Contrary to expectations for some options, but in line with expectations for all options.

#### Model 11B: Cumulative Model

```{r Model11B}
#Likelihood Plot for unlogged ceiling


#Model
b_SomeOpt11B <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days +
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+#clr_Def6Obl+
                   cln_Def3HHI+#clr_Def3toUS, 
                   cp_PairObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt11B)


b_AllOpt11B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days +
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7)

glmer_examine(b_AllOpt11B)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt10D,b_SomeOpt11A,b_SomeOpt11B,
                     
                     b_AllOpt10D,b_AllOpt11A,b_AllOpt11B,
                       type="text",
                       digits=2)

summary_residual_compare(b_SomeOpt10D,b_SomeOpt11B,bins=50)
summary_residual_compare(b_AllOpt10D,b_AllOpt11B,bins=50)
```
Contrary to expectations for some exercised, but in line with expectation for all.

Note that pairCA vf is getting awfully high.

### Other Office Characteristics
#### 12A: Past Office Volume (dollars)

Expectation: Contracting offices previously had more contract volume in dollars would have more experience managing cost and preventing cost-ceiling breaches, therefore larger past office volume would lower the likelihood of cost-ceiling breaches but no substantial relationships with likelihood of terminations or exercised options.
(Option, Breach, Termination)
Past Office Volume $s	cln_OffObl7		+	-	+
From looking at data, terminations, easier for big, less dependent. - less dependenct
For options, easier for higher volume offices, though with a drop off for the largest offices.

```{r Model12A}

summary_continuous_plot(serv_opt,metric="opt","cln_OffObl7")

#Model
b_SomeOpt12A <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_OffObl7, family=binomial(link="logit"))


b_AllOpt12A <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_OffObl7)



#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt12A,
                       
                       b_AllOpt12A,
                       type="text",
                       digits=2)


```
While expectations were not strong, for some, they were positive and significant and in line line with 


#### 12B: Detailed Industry Focus

Expectation: If a office is focused on a smaller number of industries than it has a less complex set of responsibilities which would decrease the likelihood of having cost ceiling breaches and terminations, and increase the likelihood of having options exercised.


```{r Model12B}
summary_continuous_plot(serv_opt,metric="opt","cln_OffFocus")


#Model
b_SomeOpt12B <- glm (data=serv_opt,
                 b_SomeOpt ~ cln_OffFocus, family=binomial(link="logit"))

b_AllOpt12B <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~ cln_OffFocus)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt12B,
                       
                       b_AllOpt12B,
                       type="text",
                       digits=2)

```
Contrary to expectations the result was negative and significant in both cases, though in alighnment with the scatter plots of the upper end of the date.

#### 12C: Cumulative Model

```{r Model12C}
#Likelihood Plot for unlogged ceiling


#Model
b_SomeOpt12C <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+
                     # clr_Def3toUS+
                   cp_PairObl7+
                   cln_OffObl7+cln_OffFocus , family=binomial(link="logit"))
glmer_examine(b_SomeOpt12C)

b_SomeOpt12C2 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal +
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   # cln_Def3HHI+
                     clr_Def3toUS+
                   cp_PairObl7+
                   cln_OffObl7+cln_OffFocus , family=binomial(link="logit"))
glmer_examine(b_SomeOpt12C2)


b_SomeOpt12C3 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal +
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   # cln_Def3HHI+
                     # clr_Def3toUS+
                   cp_PairObl7+
                   cln_OffObl7+cln_OffFocus , family=binomial(link="logit"))
glmer_examine(b_SomeOpt12C3)

b_SomeOpt12C4 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+
                     # clr_Def3toUS+
                   cp_PairObl7+
                   # cln_OffObl7+
                   cln_OffFocus , family=binomial(link="logit"))
glmer_examine(b_SomeOpt12C4)


b_SomeOpt12C4 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+
                     # clr_Def3toUS+
                   cp_PairObl7+
                   # cln_OffObl7+
                   cln_OffFocus , family=binomial(link="logit"))
glmer_examine(b_SomeOpt12C4)

b_SomeOpt12C5 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+
                     # clr_Def3toUS+
                   cp_PairObl7+
                    cln_OffObl7#+
                   #cln_OffFocus 
                   , family=binomial(link="logit"))
glmer_examine(b_SomeOpt12C5)


b_SomeOpt12C6 <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+
                     # clr_Def3toUS+
                   cp_PairObl7+
                    cln_OffObl7+
                   cln_OffFocus
                   , family=binomial(link="logit"))
glmer_examine(b_SomeOpt12C6)

b_AllOpt12C <- glm(data=serv_exeropt, family=binomial(link="logit"),
                        b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+cln_OffFocus
                 )

glmer_examine(b_AllOpt12C)


#Plot residuals versus fitted
stargazer::stargazer(b_SomeOpt11B,b_SomeOpt12A,b_SomeOpt12B,b_SomeOpt12C5,b_SomeOpt12C6,
                       type="text",
                       digits=2)
                     
stargazer::stargazer(b_AllOpt11B,b_AllOpt12A,b_AllOpt12B,b_AllOpt12C,
                       type="text",
                       digits=2)

summary_residual_compare(b_SomeOpt11B,b_SomeOpt12C5,b_SomeOpt11B,b_SomeOpt12C6,bins=50)
summary_residual_compare(b_AllOpt11B,b_AllOpt12C,bins=50)
```
Detailed Industry Focus unfortunately runs into VIF problems with office PBSC for the breach size model. Keeping office focus in the breach size model  does not always align with expectations, but is  significant, is a study variable and has a lower AIC, so keeping it.

Office Volume keeps its same significance and sign though pair history becomes insignificant, perhaps because offices with a great deal of volume had more history with more vendors.

##Double checking restoration of removed inputs
#### 13A: Cumulative Model
With PairCA removed, may be possible to bring back all of the Def3toUS

```{r Model12C}
#Likelihood Plot for unlogged ceiling


#Model
b_SomeOpt13A <- glm (data=serv_opt,
                 b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA +
                   cln_Base + clr_Ceil2Base + cln_Days+
                   Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+
                     clr_Def3toUS+
                   cp_PairObl7+
                   cln_OffObl7+cln_OffFocus , family=binomial(link="logit"))
glmer_examine(b_SomeOpt13A)

stargazer::stargazer(b_SomeOpt12C6,b_SomeOpt13A,
                       type="text",
                       digits=2)
                     

summary_residual_compare(b_SomeOpt12C6,b_SomeOpt13A,bins=50)

```
Once PairCA has been removed there's no real reason to leave out clr_Def3toUS, so restoring it to the model.


## Pre-Multilevel Model Summary

```{r StudyVariableSummary}


#Binary Ceiling Breaches
  stargazer::stargazer(b_SomeOpt01A,b_SomeOpt01B,b_SomeOpt02A,b_SomeOpt02B,b_SomeOpt03A,b_SomeOpt03B,b_SomeOpt03D,b_SomeOpt13A,
                       type="text",
                       digits=2)



texreg::htmlreg(list(b_SomeOpt01A,b_SomeOpt01B,b_SomeOpt02A,b_SomeOpt02B,b_SomeOpt03A,b_SomeOpt03B,b_SomeOpt03D,b_SomeOpt13A),file="..//Output//b_SomeOptmodel_lvl1.html",
                single.row = TRUE,
                # custom.model.name=c("Ceiling Breaches"),
                stars=c(0.1,0.05,0.01,0.001),
                # groups = list(
                #               "Services Complexity" = 2:3,
                #               "Office Capacity" =4:5,
                #               "Past Relationship"=6:7
                #               ),
                custom.coef.map=study_coef_list,
                bold=0.05,
                custom.note="%stars. Numerical inputs are rescaled.",
                caption="Table 6: Logit Bivariate Look at Study Variables and Ceiling Breaches",
                caption.above=TRUE)


#Absolute Size Ceiling Breaches
stargazer::stargazer(b_AllOpt01A,b_AllOpt01B,b_AllOpt02A,b_AllOpt02B,b_AllOpt03A,b_AllOpt03B,b_AllOpt03D,b_AllOpt12C,
                       type="text",
                       digits=2)


texreg::htmlreg(list(b_AllOpt01A,b_AllOpt01B,b_AllOpt02A,b_AllOpt02B,b_AllOpt03A,b_AllOpt03B,b_AllOpt03D,b_AllOpt12C),file="..//Output//b_AllOptmodel_lvl1.html",
                single.row = TRUE,
                # custom.model.name=c("Ceiling Breaches"),
                stars=c(0.1,0.05,0.01,0.001),
                #groups = list(
                #              "Services Complexity" = 2:3,
                #              "Office Capacity" =4:5,
                #              "Past Relationship"=6:7
                #              ),
                custom.coef.map=study_coef_list,
                bold=0.05,
                custom.note="%stars. Numerical inputs are rescaled.",
                caption="Table 8: Regression Bivariate Look at Study Variables and Log(Options Growth)",
                caption.above=TRUE)





```
As a brief summary for study variables:
AllOpt:
  (1) Higher service complexity variables - Both variables meet expectations, though average salary is only statistically significant at the 5% level
  (2) Office capacity variables - Only percent office PBSC is in the model - negative, statistically significant relationship, the opposite of expectations
  (3) Deeper office-vendor relationship variables - Only paired years meets expectations; paired year contract actions does not, displaying a negative, statistically significant relationship
  
SomeOpt:
  (1) Higher service complexity variables - Only invoice rate meets expectations
  (2) Office capacity variables - Only percent office PBSC is in the model - negative, statistically significant relationship, the opposite of expectations
  (3) Deeper office-vendor relationship variables - Only paired years included in model, meets expectations
  
So, to be clear, at this point:
In AllOpt model, cp_OffPSC7 has been dropped from the model (later added back).  In SomeOpt model, both cp_OffPSC7 and cln_PairCA have been dropped.

####15A: Average U.S. Salaries (logged):Contract Pricing
Cost-based and incentive contract types may do a  better job at handling complex contracts.

```{r Model15A}
#Create the models
b_SomeOpt_salary_pricing_15A_no_interact <- glm(data=serv_opt, b_SomeOpt ~ Pricing + cl_US6_avg_sal_lag1, 
                                             family=binomial(link="logit"))
glmer_examine(b_SomeOpt_salary_pricing_15A_no_interact)

b_SomeOpt_salary_pricing_15A <- glm(data=serv_opt, b_SomeOpt ~ Pricing + cl_US6_avg_sal_lag1 + Pricing:cl_US6_avg_sal_lag1,
                                 family=binomial(link="logit"))
glmer_examine(b_SomeOpt_salary_pricing_15A)


b_AllOpt_salary_pricing_15A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ Pricing + cl_US6_avg_sal_lag1)
glmer_examine(b_AllOpt_salary_pricing_15A_no_interact)

b_AllOpt_salary_pricing_15A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ Pricing + cl_US6_avg_sal_lag1 + Pricing:cl_US6_avg_sal_lag1)
glmer_examine(b_AllOpt_salary_pricing_15A)


#compare the models

stargazer::stargazer(b_SomeOpt_salary_pricing_15A_no_interact, b_SomeOpt_salary_pricing_15A, 
                     b_AllOpt_salary_pricing_15A_no_interact, b_AllOpt_salary_pricing_15A, type="text", digits=2)

summary_residual_compare(b_SomeOpt_salary_pricing_15A_no_interact, b_SomeOpt_salary_pricing_15A, bins=50)
summary_residual_compare(b_AllOpt_salary_pricing_15A_no_interact, b_AllOpt_salary_pricing_15A, bins=50)

```
Expectations hold for incentive for some contracts, though not for other cost based. That said, for both models, incentive loses significance in the original input, and thus even with a large AIC reduction it may not be worth it.
####15B: Cumulative
```{r Model15B}
#Create the model
b_SomeOpt_salary_pricing_15B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 Pricing:cl_US6_avg_sal_lag1, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_salary_pricing_15B)

b_AllOpt_salary_pricing_15B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   Pricing:cl_US6_avg_sal_lag1)
glmer_examine(b_AllOpt_salary_pricing_15B)

```
Maximum GVIF^(1/(2*Df)) greatly exceeds 2 in both cases.



####16A: Office Partnership:Actions
Performance based contracting should  encourage higher communication interactions and allow for more flexability, potentially increasing the benefits of regular interaction.
(Options, Breach, Terminations)
Interact: Actions	cp_OffPerf7:cln_PairCA			+	-	-

```{r Model16A}
#Create the models

b_SomeOpt_partnership_actions_16A_no_interact <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPerf7 + cln_PairCA, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_actions_16A_no_interact)

b_SomeOpt_partnership_actions_16A <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPerf7 + cln_PairCA + cp_OffPerf7:cln_PairCA, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_actions_16A)


#compare the models

b_AllOpt_partnership_actions_16A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cp_OffPerf7 + cln_PairCA)
glmer_examine(b_AllOpt_partnership_actions_16A_no_interact)

b_AllOpt_partnership_actions_16A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cp_OffPerf7 + cln_PairCA + cp_OffPerf7:cln_PairCA)
glmer_examine(b_AllOpt_partnership_actions_16A)


stargazer::stargazer(b_SomeOpt_partnership_actions_16A_no_interact, b_SomeOpt_partnership_actions_16A, 
                     b_AllOpt_partnership_actions_16A_no_interact, b_AllOpt_partnership_actions_16A, type="text", digits=2)

summary_residual_compare(b_SomeOpt_partnership_actions_16A_no_interact, b_SomeOpt_partnership_actions_16A, bins=3)

summary_residual_compare(b_AllOpt_partnership_actions_16A_no_interact, b_AllOpt_partnership_actions_16A, bins=3)

```
The coefficients were negative and significant in both cases, contrary to expectations.

####16B: Cumulative
```{r Model16B}
#Create the model
b_SomeOpt_partnership_actions_16B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+

                 cp_OffPerf7:cln_PairCA, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_actions_16B)

b_AllOpt_partnership_actions_16B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   cp_OffPerf7:cln_PairCA)
glmer_examine(b_AllOpt_partnership_actions_16B)

#Compare the models
stargazer::stargazer(b_AllOpt12C, b_AllOpt_partnership_actions_16B, type="text", digits=2)

summary_residual_compare(b_AllOpt12C, b_AllOpt_partnership_actions_16B,bins=50)
```
For Some options the results violate the GVIF threshold and woudl require removing an input variable to address.

For all options rhe results remain contrary to expectations and do little for residuals. 
Leaving it out.

Current cumulative b_SomeOpt model: b_SomeOpt13A
Current cumulative b_AllOpt model: b_AllOpt12C

####17A: Office Partnership:Market Vendor Share for that Office
Performance based contracting is thought to mitigte some of the risks of vendor  lock.
(option,breach,termination)
Interact: Market Share Vendor for that Office	cp_OffPerf7: cp_PairObl7			++	--	--

```{r Model17A}
#Define the models

b_SomeOpt_partnership_share_17A_no_interact <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPerf7 + cp_PairObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_share_17A_no_interact)

b_SomeOpt_partnership_share_17A <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPerf7 + cp_PairObl7 + cp_OffPerf7:cp_PairObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_share_17A)

b_AllOpt_partnership_share_17A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cp_OffPerf7 + cp_PairObl7)
glmer_examine(b_AllOpt_partnership_share_17A_no_interact)

b_AllOpt_partnership_share_17A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cp_OffPerf7 + cp_PairObl7 + cp_OffPerf7:cp_PairObl7)
glmer_examine(b_AllOpt_partnership_share_17A)


#Compare the models
stargazer::stargazer(b_SomeOpt_partnership_share_17A_no_interact, b_SomeOpt_partnership_share_17A, 
                     b_AllOpt_partnership_share_17A_no_interact, b_AllOpt_partnership_share_17A, type="text", digits=2)

summary_residual_compare(b_SomeOpt_partnership_share_17A_no_interact, b_SomeOpt_partnership_share_17A,
                         b_AllOpt_partnership_share_17A_no_interact, b_AllOpt_partnership_share_17A,bins=50)
```
Positive, in line with expectations although only significant at the p<0.05 level for some options.

####17B: Cumulative
```{r Model17B}
#Create the model
b_SomeOpt_partnership_share_17B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_share_17B)



b_AllOpt_partnership_share_17B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   cp_OffPerf7:cp_PairObl7)
glmer_examine(b_AllOpt_partnership_share_17B)



#Compare the models
stargazer::stargazer(b_SomeOpt13A, b_SomeOpt_partnership_share_17B, 
                     b_AllOpt12C, b_AllOpt_partnership_share_17B, type="text", digits=2)

summary_residual_compare(b_SomeOpt13A, b_SomeOpt_partnership_share_17B,
                         b_AllOpt12C, b_AllOpt_partnership_share_17B,bins=50)
```
Only a small improvement in AIC but significant in both cases and in line with expectation, doesn't make VIF worse. Keeping.

Current cumulative b_SomeOpt model: b_SomeOpt_partnership_share_17B
Current cumulative b_AllOpt model: b_AllOpt_partnership_share_17B


####17C: Office Volume:Market Vendor Share for that Office
A small office heavily reliant on a single vendor may just be practical consolidation of contract. For a large office, said primacy is more noteworthy and may indicate vendor lock-in. In keeping with p_Market as a whole this may mean more options exercised both in the SomeOpt and AllOpt models for lock-in reasons.  cp_OffObl7 is expected to have a positive relationship with both SomeOpt and AllOpt, while cp_PairObl7 is expected to have a positive relationship with SomeOpt and a negative relationship with AllOpt.

(option,breach,termination)
Interact: Office Volume cln_OffObl7: cp_PairObl7		+	+	-


```{r Model17A}
#Define the models


b_SomeOpt17C_no_interact <- glm(data=serv_opt, b_SomeOpt ~ cln_OffObl7 + cp_PairObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt17C_no_interact)

b_SomeOpt17C <- glm(data=serv_opt, b_SomeOpt ~ cln_OffObl7 + cp_PairObl7 + cln_OffObl7:cp_PairObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt17C)

b_AllOpt17C_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_OffObl7 + cp_PairObl7)
glmer_examine(b_AllOpt17C_no_interact)

b_AllOpt17C <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_OffObl7 + cp_PairObl7 + cln_OffObl7:cp_PairObl7)
glmer_examine(b_AllOpt17C)


#Compare the models
stargazer::stargazer(b_SomeOpt17C_no_interact, b_SomeOpt17C, 
                     b_AllOpt17C_no_interact, b_AllOpt17C, type="text", digits=2)

summary_residual_compare(b_SomeOpt17C_no_interact, b_SomeOpt17C)
summary_residual_compare(b_AllOpt17C_no_interact, b_AllOpt17C, bins = 50)
```
SomeOpt:
In model w/ no interactions, only cln_OffObl7 meets expectations.  In model with interactions, both cln_OffObl7 and the interaction term meet expectations.
AllOpt: cp_PairObl7 meets expectations in model with and without interactions.  No other variable meets expectations in either model.


####17D: Cumulative
```{r Model17D}
#Create the model
b_SomeOpt17D <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 
                   cp_OffPerf7:cp_PairObl7+cln_OffObl7:cp_PairObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt17D)


b_AllOpt17D <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   
                   cln_OffObl7:cp_PairObl7)
glmer_examine(b_AllOpt17D)


b_AllOpt17D2 <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   # 
                   cln_OffObl7:cp_PairObl7)
glmer_examine(b_AllOpt17D2)


#Compare the models
stargazer::stargazer(b_SomeOpt_partnership_share_17B, b_SomeOpt17D,
                     b_AllOpt_partnership_share_17B, b_AllOpt17D, type="text", digits=2)

summary_residual_compare(b_SomeOpt_partnership_share_17B, b_SomeOpt17D, bins = 50)
summary_residual_compare(b_AllOpt_partnership_share_17B, b_AllOpt17D2, bins = 50)
```
SomeOpt: cln_OffObl7, cln_OffFocus, cp_OffPerf7:cp_PairObl7, cp_PairObl7:cln_OffObl7 all meet expectations
AllOpt: cp_PairObl7, cln_OffFocus, and both interactions meet expectations. However, AIC increased and coefficient not significant. Leaving out.


Current cumulative b_SomeOpt model: b_SomeOpt17D
Current cumulative b_AllOpt model: b_AllOpt_partnership_share_17B


####18A: Office Partnership:Initial Contract Duration (logged)
Performance  based contracting is thought to mitigate the risks of longer time horizons and may even work  better with  them by incentivizing vendor investments.
(option, breach, term)
Interact: Initial Contract Duration (logged)	cp_OffPerf7: capped_cln_Days			++	--	--

```{r Model18A}
#Create the Model
b_SomeOpt_partnership_duration_18A_no_interact <- glm(data=serv_opt , b_SomeOpt ~ cp_OffPerf7 + cln_Days, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_duration_18A_no_interact)

b_SomeOpt_partnership_duration_18A <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPerf7 + cln_Days + cp_OffPerf7: cln_Days, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_duration_18A)

b_AllOpt_partnership_duration_18A_no_interact <- glm(data=serv_exeropt , b_AllOpt ~ cp_OffPerf7 + cln_Days)
glmer_examine(b_AllOpt_partnership_duration_18A_no_interact)

b_AllOpt_partnership_duration_18A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cp_OffPerf7 + cln_Days + cp_OffPerf7: cln_Days)
glmer_examine(b_AllOpt_partnership_duration_18A)

#Compare the models
stargazer::stargazer(b_SomeOpt_partnership_duration_18A_no_interact, b_SomeOpt_partnership_duration_18A, 
                     b_AllOpt_partnership_duration_18A_no_interact, b_AllOpt_partnership_duration_18A,
                     type="text", digits=2)

summary_residual_compare(b_SomeOpt_partnership_duration_18A_no_interact, b_SomeOpt_partnership_duration_18A)
summary_residual_compare(b_AllOpt_partnership_duration_18A_no_interact, b_AllOpt_partnership_duration_18A)
```
VIF for b_AllOpt_partnership_duration_18A is very elevated, but correct GVIF in the next section is acceptable, so will retain this interaction for now.

SomeOpt: Interaction is the opposite of expectations.
AllOpt: Interaction meets expectations

####18B: Cumulative
```{r Model18B}
#Create the model
b_SomeOpt_partnership_duration_18B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   cln_OffObl7:cp_PairObl7+
                 cp_OffPerf7:cln_Days, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_partnership_duration_18B)

b_AllOpt_partnership_duration_18B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   cp_OffPerf7:cln_Days)
glmer_examine(b_AllOpt_partnership_duration_18B)

b_AllOpt_partnership_duration_18B2 <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 # cp_OffPerf7:cp_PairObl7+
                   cp_OffPerf7:cln_Days)
glmer_examine(b_AllOpt_partnership_duration_18B2)


#Compare the models
stargazer::stargazer(b_SomeOpt_partnership_share_17B, b_SomeOpt_partnership_duration_18B, 
                     b_AllOpt_partnership_share_17B, b_AllOpt_partnership_duration_18B2, type="text", digits=2)

summary_residual_compare(b_SomeOpt_partnership_share_17B, b_SomeOpt_partnership_duration_18B,
                         b_AllOpt_partnership_share_17B, b_AllOpt_partnership_duration_18B2, bins = 50)
```
In both models, interaction terms lose their significance.  Residuals for b_AllOpt model are edgng towards intolerable even after removing related variables, and since the interaction isn't significant in either model specification and AIC goes up, dropping it.


Current cumulative b_SomeOpt model: b_SomeOpt17D
Current cumulative b_AllOpt model: b_AllOpt_partnership_share_17B

####19A: Past Years:Contract Pricing
Positive prior relationships increase the effectiveness of cost-based contracts. T&M / LH / FP: LoE are in the middle here, so leaving  them out.

(Option, Breach,Term)
Firm-Fixed Price (base)				-	+	+
Other Fixed Price				-	+	+
Time & Materials / Labor Hours / FP: LoE						
Incentive Fee (both FPIF or CBIF)				++	--	--
Other Cost Based				+	-	-
Undefinitized Contract Award				+	-	-
Combination				+	-	-
```{r Model19A}
#Create the models
b_SomeOpt_history_pricing_19A_no_interact <- glm(data=serv_opt, b_SomeOpt ~ cn_PairHist7 + Pricing, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_history_pricing_19A_no_interact)

b_SomeOpt_history_pricing_19A <- glm(data=serv_opt, b_SomeOpt ~ cn_PairHist7 + Pricing + cn_PairHist7:Pricing, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_history_pricing_19A)

b_AllOpt_history_pricing_19A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cn_PairHist7 + Pricing)
glmer_examine(b_AllOpt_history_pricing_19A_no_interact)

b_AllOpt_history_pricing_19A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cn_PairHist7 + Pricing + cn_PairHist7:Pricing)
glmer_examine(b_AllOpt_history_pricing_19A)


#Compare the models
stargazer::stargazer(b_SomeOpt_history_pricing_19A_no_interact, b_SomeOpt_history_pricing_19A,
                     b_AllOpt_history_pricing_19A_no_interact, b_AllOpt_history_pricing_19A,
                     type="text", digits=2)

summary_residual_compare(b_SomeOpt_history_pricing_19A_no_interact, b_SomeOpt_history_pricing_19A)
summary_residual_compare(b_AllOpt_history_pricing_19A_no_interact, b_AllOpt_history_pricing_19A)

```
Again, VIF scores elevated in AllOpt model, but fall into acceptable tolerances when considering scaled GVIFs in the next section, so are tolerated here.

SomeOpt: Expectations met for incentive-based cotnract, other cost-based contracts, and undefinitized contract awards.

AllOpt: Expectations met for Other cost-based contracts and undefinitized contract awards.


####19B: Cumulative
```{r Model19B}
#Create the model
b_SomeOpt_history_pricing_19B <- glm(data=serv_opt,
                                  b_SomeOpt ~  cln_US6sal + 
                                    cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                                    cn_PairHist7+#cln_PairCA+
                                    cln_Base + clr_Ceil2Base + cln_Days+
                                    Comp+
                                    Veh+
                                    Pricing+
                                    Crisis+
                                    cln_Def6HHI+clr_Def6toUS+
                                    cln_Def3HHI+
                                    clr_Def3toUS+
                                    cp_PairObl7+
                                    cln_OffObl7+ 
                                    cln_OffFocus+ 
                                    cp_OffPerf7:cp_PairObl7+
                                    cln_OffObl7:cp_PairObl7+
                                    cp_OffPerf7:cln_Days+
                                    cn_PairHist7:Pricing, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_history_pricing_19B)

b_AllOpt_history_pricing_19B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   
                   cn_PairHist7:Pricing)
glmer_examine(b_AllOpt_history_pricing_19B)


#Compare the models
stargazer::stargazer(b_SomeOpt_partnership_duration_18B, b_SomeOpt_history_pricing_19B,
                     b_AllOpt_partnership_share_17B, b_AllOpt_history_pricing_19B, type="text", digits=2)

summary_residual_compare(b_SomeOpt_partnership_duration_18B, b_SomeOpt_history_pricing_19B, 
                         b_AllOpt_partnership_share_17B, b_AllOpt_history_pricing_19B, bins = 50)
```
SomeOpt: Expectations met for incentive pricing interaction and combination pricing interaction
AllOpt: Expectations are not met for any interactions. No decrease in AIC, leaving it out.

Current cumulative b_SomeOpt model: b_SomeOpt_history_pricing_19B
Current cumulative b_AllOpt model: b_AllOpt_partnership_share_17B


####20A: Competition:NAICS6 Detailed Industry (Level 6)
If competition is an instrument for consolidation, than it should be most effective when consolidation is lower.

(Option, Breach,Term)
No Competition (Baseline)				-	++	-
1 Offer:				-	+	-
2-4 Offers				+	-	+
5+ Offers				-	-	+
```{r Model20A}
#Create the models
#NAICS66 Detailed Industry
b_SomeOpt_competition_NAICS66_20A_no_interact <- glm(data=serv_opt, b_SomeOpt ~ Comp + cln_Def6HHI, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_competition_NAICS66_20A_no_interact)

b_SomeOpt_competition_NAICS66_20A <- glm(data=serv_opt, b_SomeOpt ~ Comp + cln_Def6HHI + Comp:cln_Def6HHI, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_competition_NAICS66_20A)

b_AllOpt_competition_NAICS66_20A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ Comp + cln_Def6HHI)
glmer_examine(b_AllOpt_competition_NAICS66_20A_no_interact)

b_AllOpt_competition_NAICS66_20A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ Comp + cln_Def6HHI + Comp:cln_Def6HHI)
glmer_examine(b_AllOpt_competition_NAICS66_20A)

#NAICS3 Subsector
b_SomeOpt_competition_NAICS66_20A_no_interact <- glm(data=serv_opt, b_SomeOpt ~ Comp + cln_Def3HHI, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_competition_NAICS66_20A_no_interact)

b_SomeOpt_competition_NAICS66_20A <- glm(data=serv_opt, b_SomeOpt ~ Comp + cln_Def3HHI + Comp:cln_Def3HHI, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_competition_NAICS66_20A)

b_AllOpt_competition_NAICS66_20A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ Comp + cln_Def3HHI)
glmer_examine(b_AllOpt_competition_NAICS66_20A_no_interact)

b_AllOpt_competition_NAICS66_20A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ Comp + cln_Def3HHI + Comp:cln_Def3HHI)
glmer_examine(b_AllOpt_competition_NAICS66_20A)


```
The interaction models consistently exceed VIF with both NAICS66 and NAICS3 HHI
####20B: Cumulative
```{r Model20B}
#Create the model
#NAICS66 Detailed Industry
b_SomeOpt_competition_NAICS66_20B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                                  cp_OffPerf7:cp_PairObl7+
                   cln_OffObl7:cp_PairObl7+
                 cp_OffPerf7:cln_Days+
                   Comp:cln_Def6HHI, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_competition_NAICS66_20B)

b_AllOpt_competition_NAICS66_20B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   
                   Comp:cln_Def6HHI)
glmer_examine(b_AllOpt_competition_NAICS66_20B)


#NAICS3 Subsector
b_SomeOpt_competition_naincs3_20B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                                  cp_OffPerf7:cp_PairObl7+
                   cln_OffObl7:cp_PairObl7+
                 cp_OffPerf7:cln_Days+
                   Comp:cln_Def3HHI, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_competition_naincs3_20B)



b_AllOpt_competition_naincs3_20B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   
                   Comp:cln_Def3HHI)
glmer_examine(b_AllOpt_competition_naincs3_20B)

b_AllOpt_competition_naincs3_20B2 <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   # 
                   Comp:cln_Def6HHI)
glmer_examine(b_AllOpt_competition_naincs3_20B2)

```
For all HHI6 and HHI3 models, scaled GVIF is exceeded even with removal of other interaction terms.  Thus, this interaction is not included in our model specification.

####21A: Ratio Initial Base to Ceiling Ratio (logged):Initial Contract Ceiling (logged)
This interaction approximates has a role similar to that of contract ceiling, although due to centering and logging it isn't equivalent. Thus in essence it covers the dollars rather than merely the proportion available for options. More option  space gives more flexibility to the government and may lessen the need for ceiling breaches and terminations. Likewise, this interaction provides something like the dollar size of available  options, so naturally it can be associated with greater spending.
(Options, Breach, Terminations)
Initial Contract Ceiling (logged)	clr_Ceil2Base:cln_Base		TRUE	++	-	-
Expectation - interaction is positively related to b_SomeOpt and negatively related to b_AllOpt.

```{r Model21A}
#Create the models
b_SomeOpt_base2ceil_ceiling_21A_no_interact <- glm(data=serv_opt,b_SomeOpt ~ clr_Ceil2Base + cln_Base, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_base2ceil_ceiling_21A_no_interact)

b_SomeOpt_base2ceil_ceiling_21A <- glm(data=serv_opt, b_SomeOpt ~ clr_Ceil2Base + cln_Base + clr_Ceil2Base:cln_Base, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_base2ceil_ceiling_21A)

b_AllOpt_base2ceil_ceiling_21A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ clr_Ceil2Base + cln_Base)

glmer_examine(b_AllOpt_base2ceil_ceiling_21A_no_interact)

b_AllOpt_base2ceil_ceiling_21A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ clr_Ceil2Base + cln_Base + clr_Ceil2Base:cln_Base)
glmer_examine(b_AllOpt_base2ceil_ceiling_21A)

#Compare the Models
stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21A_no_interact, b_SomeOpt_base2ceil_ceiling_21A, 
                     b_AllOpt_base2ceil_ceiling_21A_no_interact, b_AllOpt_base2ceil_ceiling_21A, type="text", digits=2)

summary_residual_compare(b_SomeOpt_base2ceil_ceiling_21A_no_interact, b_SomeOpt_base2ceil_ceiling_21A, bins = 50)
summary_residual_compare(b_AllOpt_base2ceil_ceiling_21A_no_interact, b_AllOpt_base2ceil_ceiling_21A, bins = 50)
```
SomeOpt: Expectation met
AllOpt: Expectation not met


####21B: Cumulative
```{r Model21B}
#Create the model
b_SomeOpt_base2ceil_ceiling_21B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                cp_OffPerf7:cp_PairObl7+
                  cln_OffObl7:cp_PairObl7+
                 cp_OffPerf7:cln_Days+
                  cn_PairHist7:Pricing +
                   clr_Ceil2Base:cln_Base, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_base2ceil_ceiling_21B)


b_AllOpt_base2ceil_ceiling_21B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                   cln_Def6HHI+clr_Def6toUS+
                   cln_Def3HHI+
                   clr_Def3toUS+
                   cp_PairObl7+
                   cln_OffObl7+
                   cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   clr_Ceil2Base:cln_Base)
glmer_examine(b_AllOpt_base2ceil_ceiling_21B)


#Compare the models
stargazer::stargazer(b_SomeOpt_history_pricing_19B, b_SomeOpt_base2ceil_ceiling_21B, 
                     type = "text", digits = 2)

summary_residual_compare(b_SomeOpt_partnership_duration_18B, b_SomeOpt_base2ceil_ceiling_21B, bins = 50)
```
SomeOpt: Expectation met, though residuals get a bit worse.
AllOpt: Scaled GVIF above threshold for cln_Base and cln_Base:clr_Ceil2Base. 

Current cumulative b_SomeOpt model: b_SomeOpt_base2ceil_ceiling_21B
Current cumulative b_AllOpt model: b_SomeOpt_history_pricing_19B

####21C: Available Options:Initial Contract Duration (logged)
increase the extend of options exercised as it means continuing a contract rather than including additional features. Option years may also provide more options for cost controls. and reduce ceiling breaches.
(Options, Ceiling Breach, Terminations)
++	-	-
Expectation: Pos. relationship with SomeOpt, negative relationship with AllOpt.
```{r Model21C}
b_SomeOpt_base2ceil_duration_21C_no_interact <- glm(data=serv_opt, b_SomeOpt ~ clr_Ceil2Base + cln_Days, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_base2ceil_duration_21C_no_interact)

b_SomeOpt_base2ceil_duration_21C <- glm(data=serv_opt, b_SomeOpt ~ clr_Ceil2Base + cln_Days + clr_Ceil2Base:cln_Days, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_base2ceil_duration_21C)

b_AllOpt_base2ceil_duration_21C_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ clr_Ceil2Base + cln_Days)
glmer_examine(b_AllOpt_base2ceil_duration_21C_no_interact)

b_AllOpt_base2ceil_duration_21C <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ clr_Ceil2Base + cln_Days + clr_Ceil2Base:cln_Days)
glmer_examine(b_AllOpt_base2ceil_duration_21C)

stargazer::stargazer(b_SomeOpt_base2ceil_duration_21C_no_interact, b_SomeOpt_base2ceil_duration_21C, type = "text", digits = 2)

```
VIF exceeds acceptable threshold for AllOpt.  Worryingly high for SomeOpt, but not above reject threshold since brought down to tolerable levels in cumulative model (>2 requires check in cumulative, >3 is an instant rejection).

Matches expectations in SomeOpt model.

####21D: Cumulative
```{r Model21D}
#Create the model
b_SomeOpt_base2ceil_duration_21D <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7+
                   cln_OffObl7:cp_PairObl7+
                   cp_OffPerf7:cln_Days+ 
                   cn_PairHist7:Pricing +
                   clr_Ceil2Base:cln_Base+
                   clr_Ceil2Base:cln_Days, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_base2ceil_duration_21D)

b_AllOpt_base2ceil_duration_21D <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   clr_Ceil2Base:cln_Days)
glmer_examine(b_AllOpt_base2ceil_duration_21D)


#Compare the models
stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt_base2ceil_duration_21D, 
                     b_AllOpt_partnership_share_17B, b_AllOpt_base2ceil_duration_21D, type="text", digits=2)

summary_residual_compare(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt_base2ceil_duration_21D, bins = 50,
                         b_AllOpt_partnership_share_17B, b_AllOpt_base2ceil_duration_21D)
```
 Statistically significant but disagrees with expectations in SomeOpt model and little benefit on AIC on the some size.  
 For all options significant and small lowering of AIC, but raises GVIF near to around 1.8 threshold and contrary to expectation. For all, greater reduction in AIC but raises GVIF to around 1.97 Choose not to include. Not included in either model

Current cumulative b_SomeOpt model: b_SomeOpt_base2ceil_ceiling_21B
Current cumulative b_AllOpt model: b_AllOpt_partnership_share_17B

####22A: CFTE (logged):Contract Pricing
Cost-based and incentive contract types may do a better job at handling complex contracts.

```{r Model22A}
#Create the models
b_SomeOpt_CFTE_pricing_22A_no_interact <- glm(data=serv_opt, b_SomeOpt ~ Pricing + cln_PSCrate, 
                                             family=binomial(link="logit"))
glmer_examine(b_SomeOpt_CFTE_pricing_22A_no_interact)

b_SomeOpt_CFTE_pricing_22A <- glm(data=serv_opt, b_SomeOpt ~ Pricing + cln_PSCrate + Pricing:cln_PSCrate,
                                 family=binomial(link="logit"))
glmer_examine(b_SomeOpt_CFTE_pricing_22A)


b_AllOpt_CFTE_pricing_22A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ Pricing + cln_PSCrate)
glmer_examine(b_AllOpt_CFTE_pricing_22A_no_interact)

b_AllOpt_CFTE_pricing_22A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ Pricing + cln_PSCrate + Pricing:cln_PSCrate)
glmer_examine(b_AllOpt_CFTE_pricing_22A)


#compare the models

stargazer::stargazer(b_SomeOpt_CFTE_pricing_22A_no_interact, b_SomeOpt_CFTE_pricing_22A, 
                     b_SomeOpt_salary_pricing_15A_no_interact, b_SomeOpt_salary_pricing_15A, 
                     type="text", digits=2)
stargazer::stargazer(b_AllOpt_salary_pricing_15A_no_interact, b_AllOpt_salary_pricing_15A, 
                     b_AllOpt_CFTE_pricing_22A_no_interact, b_AllOpt_CFTE_pricing_22A, type="text", digits=2)

summary_residual_compare(b_SomeOpt_CFTE_pricing_22A_no_interact, b_SomeOpt_CFTE_pricing_22A, 
                         b_AllOpt_CFTE_pricing_22A_no_interact, b_AllOpt_CFTE_pricing_22A, bins=3)

```
GVIF above acceptable threshold in both models - will not include.

####22B: Cumulative
```{r Model22B}
#Create the model
b_SomeOpt_CFTE_pricing_22B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                                     
                   cp_OffPerf7:cp_PairObl7+
                 cp_OffPerf7:cln_Days+
                   
                   cn_PairHist7:Pricing+
                   clr_Ceil2Base:cln_Base+
                 Pricing:cln_PSCrate, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_CFTE_pricing_22B)

b_SomeOpt_CFTE_pricing_22B2 <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                                     
                   cp_OffPerf7:cp_PairObl7+
                 cp_OffPerf7:cln_Days+
                   
                   # cn_PairHist7:Pricing+
                   clr_Ceil2Base:cln_Base+
                 Pricing:cln_PSCrate, family=binomial(link="logit"))
glmer_examine(b_SomeOpt_CFTE_pricing_22B2)

b_AllOpt_CFTE_pricing_22B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                   
                 cln_OffFocus+
                 cp_OffPerf7:cp_PairObl7+
                   
                   Pricing:cln_PSCrate)
glmer_examine(b_AllOpt_CFTE_pricing_22B)



#Compare the models
  stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt_CFTE_pricing_22B,
                       b_SomeOpt_CFTE_pricing_22B2,
                       b_AllOpt_partnership_share_17B, b_AllOpt_CFTE_pricing_22B, type="text", digits=2)

summary_residual_compare(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt_CFTE_pricing_22B,
                         b_SomeOpt_CFTE_pricing_22B, b_SomeOpt_CFTE_pricing_22B2,bins=50)
summary_residual_compare(b_AllOpt_partnership_share_17B, b_AllOpt_CFTE_pricing_22B)

```
Some is not significant in line with expectation and raises the AIC slightly. Swapping to use of just PSCrate:Pricing increases AIC, more though is more in line with expectations. Leaving out, though swapping for model alignment has some appeal.

Aligns with expectation and lowers AIC a bit for all options model, although incentive fee results are not significant. Tentatively adding. 

Current cumulative b_SomeOpt model: b_SomeOpt_base2ceil_ceiling_21B
Current cumulative b_AllOpt model: b_AllOpt_CFTE_pricing_22B

####23A: Office Serv. Code Exp:Office Obligations
A large office may be able to more effectively divide its attention, limiting the downsides of a small experience share.  The estimated outcomes are negative for options and positive for ceiling breaches and terminations because this would be expected to enhance the better performance outcomes expected for the input of cp_PSC7


(Options, Ceiling, Termination)
Interact: Office Obligations	cp_PSC7:cln_OffObl7			-	+	+

```{r Model23A}
summary_double_continuous(serv_opt,"cp_OffPSC7","cln_OffObl7",metric="opt")

#Create the models
b_SomeOpt23A_no_interact <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPSC7 + cln_OffObl7, 
                                             family=binomial(link="logit"))
glmer_examine(b_SomeOpt23A_no_interact)

b_SomeOpt23A <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPSC7 + cln_OffObl7 + cp_OffPSC7:cln_OffObl7,
                                 family=binomial(link="logit"))
glmer_examine(b_SomeOpt23A)


b_AllOpt23A_no_interact <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cp_OffPSC7 + cln_OffObl7)
glmer_examine(b_AllOpt23A_no_interact)

b_AllOpt23A <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cp_OffPSC7 + cln_OffObl7 + cp_OffPSC7:cln_OffObl7)
glmer_examine(b_AllOpt23A)


#compare the models

stargazer::stargazer(b_SomeOpt23A_no_interact, 
                     b_SomeOpt23A,
                     type="text", digits=2)


summary_residual_compare(b_SomeOpt23A_no_interact, b_SomeOpt23A, bins=5)

```
GVIF for AllOpt model is above 2, triggering a review of the cumulative model.  Scaled GVIF in cumulative model is acceptable, so we retain the interaction here.  Interaction is strongly negative and statistically significant, as expected.

GVIF for SomeOpt model acceptable.  Interaction does not meet expectation.



####23B: Cumulative
```{r Model23B}
#Create the model
b_SomeOpt23B <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7+
                   cln_OffObl7:cp_PairObl7+
                 cn_PairHist7:Pricing + 
                   clr_Ceil2Base:cln_Base+
                   cp_OffPSC7:cln_OffObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt23B)

b_SomeOpt23B2 <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7+
                 cn_PairHist7:Pricing + 
                   # clr_Ceil2Base:cln_Base+
                   cp_OffPSC7:cln_OffObl7, family=binomial(link="logit"))
glmer_examine(b_SomeOpt23B2)

b_AllOpt23B <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   cp_OffPerf7:cp_PairObl7 +
                   
                   Pricing:cln_PSCrate+
                   
                   Pricing:cln_PSCrate + 
                   cp_OffPSC7:cln_OffObl7)
glmer_examine(b_AllOpt23B)

#Compare the models
  stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt23B, type="text", digits=2)

summary_residual_compare(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt23B, bins = 50)

```
For SomeOpt, interaction violates expectations and does raise GVIF near 2. Taking out clr_Ceil2Base:cln_Base does little to help.  For AllOpt, GVIF exceeds 2. Leaving out.

Current cumulative b_SomeOpt model: b_SomeOpt_base2ceil_ceiling_21B
Current cumulative b_AllOpt model: b_AllOpt_CFTE_pricing_22B


####24A:Restore cln_PairCA?
```{r Model24A}
#Create the model
b_SomeOpt24A <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7+
                 cn_PairHist7:Pricing + 
                   clr_Ceil2Base:cln_Base, family=binomial(link="logit"))
glmer_examine(b_SomeOpt24A)



b_SomeOpt24A2 <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7+
                   
                 cn_PairHist7:Pricing,
                   # cp_OffPSC7:cln_OffObl7+, 
                 # clr_Ceil2Base:cln_Base
                 family=binomial(link="logit"))
glmer_examine(b_SomeOpt24A2)



b_SomeOpt24A3 <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7,
                 # cn_PairHist7:Pricing ,#+ 
                   # clr_Ceil2Base:cln_Base,#+
                   # cp_OffPSC7:cln_OffObl7+, 
                 family=binomial(link="logit"))
glmer_examine(b_SomeOpt24A3)


stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B,b_SomeOpt24A3,type = "text", digits = 2)
```
Still encounters VIF trouble.

####24B: Office Serv. Code Exp:Office Focus
A large office may be able to more effectively divide its attention, limiting the downsizes of a small experience share.  The estimated outcomes are negative for options and positive for ceiling breaches and terminations because this would be expected to enhance the better performance outcomes expected for the input of cp_PSC7

(Options, Ceiling, Termination)
Interact: Office Obligations	cp_PSC7:cln_OffObl7			-	+	+

```{r Model24B}
#Create the models
b_SomeOpt24B_no_interact <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPSC7 + cln_OffFocus, 
                                             family=binomial(link="logit"))
glmer_examine(b_SomeOpt24B_no_interact)

b_SomeOpt24B <- glm(data=serv_opt, b_SomeOpt ~ cp_OffPSC7 + cln_OffFocus + cp_OffPSC7:cln_OffFocus,
                                 family=binomial(link="logit"))
glmer_examine(b_SomeOpt24B)

b_AllOpt24B_no_interact <- glm(data=serv_exeropt, b_AllOpt ~ cp_OffPSC7 + cln_OffFocus, 
                                             family=binomial(link="logit"))
glmer_examine(b_AllOpt24B_no_interact)

b_AllOpt24B <- glm(data=serv_exeropt, b_AllOpt ~ cp_OffPSC7 + cln_OffFocus + cp_OffPSC7:cln_OffFocus, family = binomial(link = "logit"))
glmer_examine(b_AllOpt24B)

stargazer::stargazer(b_AllOpt24B, type = "text", digits = 2)

```
VIF measures indicate multicolinearity for SomeOpt model, and so not included.  Requires checking of cumulative model specification for AllOpt, where it is accepted.  Expectations met for AllOpt model.


####24C: Cumulative
```{r Model24C}
#Create the model
b_SomeOpt24C <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7+
                 cn_PairHist7:Pricing + 
                   clr_Ceil2Base:cln_Base+
                   cp_OffPSC7:cln_OffFocus, family=binomial(link="logit"))
glmer_examine(b_SomeOpt24C)



b_SomeOpt24C2 <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7+
                   
                   cn_PairHist7:Pricing + 
                   # clr_Ceil2Base:cln_Base
                   cp_OffPSC7:cln_OffFocus, family=binomial(link="logit"))
glmer_examine(b_SomeOpt24C2)


#AllOpt
b_AllOpt24C <- glm(data=serv_exeropt, family=binomial(link="logit"), b_AllOpt ~ cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   cp_OffPerf7:cp_PairObl7 + 
                   
                   Pricing:cln_PSCrate+ 
                   cp_OffPSC7:cln_OffFocus)
glmer_examine(b_AllOpt24C)

stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B,b_SomeOpt24C2,
                     b_AllOpt_CFTE_pricing_22B, b_AllOpt24C, type = "text", digits = 2)
summary_residual_compare(b_SomeOpt_base2ceil_ceiling_21B,b_SomeOpt24C2,
                         b_AllOpt_CFTE_pricing_22B, b_AllOpt24C, bins = 50)
```
GVIF precludes inclusion for SomeOp unless cp_OffPSC7:cln_OffObl7 and cln_Base:clr_Ceil2Base  are emoved. Moreover the GVIF is still at 1.89 for PSCrate in the resulting model. Leaving it out for SomeOtp.

Included for AllOpt - expectations met.

Current cumulative b_SomeOpt model: b_SomeOpt_base2ceil_ceiling_21B
Current cumulative b_AllOpt model: b_AllOpt24C

####24D: Office Obligations:Office Focus
A large office may be able to more effectively divide its attention, limiting the upsides of focus. The estimated outcomes are negative for options and positive for ceiling breaches and terminations because this would be expected to enhance the better performance outcomes expected for the input of cp_PSC7

(Options, Ceiling, Termination)
Interact: Office Obligations	cp_PSC7:cln_OffObl7			-	+	+

```{r Model24D}
#Create the models
b_SomeOpt24D_no_interact <- glm(data=serv_opt, b_SomeOpt ~ cln_OffObl7 + cln_OffFocus, 
                                             family=binomial(link="logit"))
glmer_examine(b_SomeOpt24D_no_interact)

b_SomeOpt24D <- glm(data=serv_opt, b_SomeOpt ~ cln_OffObl7 + cln_OffFocus + cln_OffObl7:cln_OffFocus,
                                 family=binomial(link="logit"))

b_AllOpt24D <- glm(data=serv_exeropt, b_AllOpt ~ cln_OffObl7 + cln_OffFocus + cln_OffObl7:cln_OffFocus, family=binomial(link="logit"))

glmer_examine(b_SomeOpt24D)
glmer_examine(b_AllOpt24D)

stargazer::stargazer(b_SomeOpt24D, b_AllOpt24D, type = "text", digits = 2)
summary_residual_compare(b_SomeOpt_base2ceil_ceiling_21B, bins = 50)

```
Expectations met for both models.

####24E: Cumulative
```{r Model24E}
#Create the model
b_SomeOpt24E <- glm(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                   cp_OffPerf7:cp_PairObl7+
                   cp_OffPerf7:cln_Days+
                 cn_PairHist7:Pricing + 
                   clr_Ceil2Base:cln_Base+
                   # cp_OffPSC7:cln_OffObl7+
                   cln_OffObl7:cln_OffFocus, family=binomial(link="logit"))
glmer_examine(b_SomeOpt24E)


b_AllOpt24E <- glm(data=serv_exeropt,
                         b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   cp_OffPerf7:cp_PairObl7 + 
                  # cp_OffPerf7:cln_PairCA + 
                   cp_OffPSC7:cln_OffFocus+
                   
                   Pricing:cln_PSCrate+
                      # cp_OffPerf7:cln_Days+
                 # Pricing:cln_PSCrate+
                   cln_OffObl7:cln_OffFocus, family=binomial(link="logit"))
glmer_examine(b_AllOpt24E)


#Compare the models
  stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt24E, 
                       b_AllOpt24C, b_AllOpt24E, type = "text", digits=2)

summary_residual_compare(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt24E,
                         b_AllOpt24C, b_AllOpt24E2,bins=50)

```
SomeOpt - Aligns with expectations, but raises AIC.
AllOpt - Aligns with expectations and lowers AIC.

Final pre-multilevel run model selections are:
SomeOpt: b_SomeOpt_base2ceil_ceiling_21B
AllOpt: b_AllOpt24E

# Multilevel Model
####25A: 2019-08-20 First run, original multilevel.
This was created while we were still using ceiling instead of base.

```{r CBre25A}
if(file.exists("..//Output//b_SomeOpt25A.rda")) load("..//Output//b_SomeOpt25A.rda")
if(file.exists("..//Output//b_AllOpt25A.rda")) load("..//Output//b_AllOpt25A.rda")

if(!exists("b_SomeOpt25A")){
#Create the model
  b_SomeOpt25A <- glmer(data=serv_opt, b_SomeOpt ~  cln_US6sal +
                       cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                       cn_PairHist7+#cln_PairCA+
                       cln_Base + clr_Ceil2Base + cln_Days+
                       Comp+
                       Veh+
                       Pricing+
                       Crisis+
                       cln_Def6HHI+clr_Def6toUS+
                       cln_Def3HHI+
                       clr_Def3toUS+
                       cp_PairObl7+
                       cln_OffObl7+
                       cln_OffFocus+
                       cp_OffPerf7:cp_PairObl7+
                       cp_OffPerf7:cln_Days+
                       clr_Ceil2Base:cln_Base+
                       (1 | NAICS3/NAICS6/ServArea)+
                       (1 | Agency/Office) +
                       (1 | Place)+
                       (1 | StartFY),
                     family=binomial(link="logit"),
                     verbose=TRUE)
  
  b_AllOpt25A <- glmer(data=serv_exeropt, b_AllOpt ~ cln_US6sal + 
                      cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                      cn_PairHist7+cln_PairCA+
                      cln_Base + clr_Ceil2Base + cln_Days+
                      Comp+
                      Veh+
                      Pricing+
                      Crisis+
                      cln_Def6HHI+clr_Def6toUS+
                      cln_Def3HHI+
                      clr_Def3toUS+
                      cp_PairObl7+
                      cln_OffObl7+ 
                      cln_OffFocus+
                      cp_OffPerf7:cp_PairObl7+
                      cp_OffPerf7:cln_PairCA +
                      cp_OffPSC7:cln_OffObl7 + 
                      cp_OffPSC7:cln_OffFocus + 
                      (1 | NAICS3/NAICS6/ServArea)+  
                      (1 | Agency/Office) +
                      (1 | Place)+ 
                      (1 | StartFY),
                      family=binomial(link="logit"),
                      verbose=TRUE)
  
  save(b_SomeOpt25A,b_AllOpt25A,file="..\\output\\Opt25A.rda")
}

#Compare the models
  glmer_examine(b_SomeOpt25A,display = TRUE)
glmer_examine(b_AllOpt25A,display = TRUE)


stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt25A, 
                     b_AllOpt24E, b_AllOpt25A, type="text", digits=2)


stargazer::stargazer(b_AllOpt25A, type = "text", digits = 2)

stargazer::stargazer(b_SomeOpt25A, b_AllOpt25A, type = "text", digits = 2)

summary_residual_compare(b_SomeOpt_base2ceil_ceiling_21B, b_SomeOpt25A, 
                     b_AllOpt_CFTE_pricing_22B, b_AllOpt25A, bins=100)



# texreg::htmlreg(list(b_SomeOpt25A, b_AllOpt25A),file="..//Output//options_25A.html",
#                 single.row = TRUE,
#                 custom.model.name=c("Some Options Exercised", "All Options Exercised"),
#                 stars=c(0.1,0.05,0.01,0.001),
#                 groups = list(
#                                "Services Complexity" = 2:3,
#                                "Office Capacity" =4:5,
#                                "Past Relationship"=6:7,
#                                "Contract Characteristics"=8:26,
#                                "NAICS Characteristics" =27:30,
#                                "Office Characteristics" =31:33,
#                                "Interactions"=34:39
#                               ),
#                 custom.coef.map=all_coef_list,
#                 bold=0.05,
#                 custom.note="%stars. Numerical inputs are rescaled.",
#                 caption="Table 6: Exercised Options",
#                 caption.above=TRUE)

```

####25B: 2019-08-28 - Modified SomeOpt and AllOpt models for multilevel model run (attempting to leverage GVIF declines in multilevel model in 25A).

```{r Opt25B}
if(file.exists("..//Output//Opt25B.rda")) load("..//Output//Opt25B.rda")
if(file.exists("..//Output//b_SomeOpt25B.rda")) load("..//Output//b_SomeOpt25B.rda")
if(file.exists("..//Output//b_AllOpt25B.rda")) load("..//Output//b_AllOpt25B.rda")

if(!exist("b_SomeOpt25B")){
  b_SomeOpt25B <- glmer(data=serv_opt, b_SomeOpt ~  cln_US6sal +
                          cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                          cn_PairHist7+cln_PairCA+
                          cln_Base + clr_Ceil2Base + cln_Days+
                          Comp+
                          Veh+
                          Pricing+
                          Crisis+
                          cln_Def6HHI+clr_Def6toUS+
                          cln_Def3HHI+
                          clr_Def3toUS+
                          cp_PairObl7+
                          cln_OffObl7+
                          cln_OffFocus+
                          cp_OffPerf7:cp_PairObl7+
                          cp_OffPerf7:cln_Days+
                          clr_Ceil2Base:cln_Base+
                          Pricing:cln_PSCrate+
                          (1 | NAICS3/NAICS6/ServArea)+
                          (1 | Agency/Office) +
                          (1 | Place)+
                          (1 | StartFY),
                        family=binomial(link="logit"),
                        verbose=TRUE)
  
  
  b_AllOpt25B <- glmer(data=serv_exeropt, b_AllOpt ~ cln_US6sal + 
                         cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                         cn_PairHist7+cln_PairCA+
                         cln_Base + clr_Ceil2Base + cln_Days+
                         Comp+
                         Veh+
                         Pricing+
                         Crisis+
                         cln_Def6HHI+clr_Def6toUS+
                         cln_Def3HHI+
                         clr_Def3toUS+
                         cp_PairObl7+
                         cln_OffObl7+ 
                         cln_OffFocus+
                         cp_OffPerf7:cp_PairObl7+
                         cp_OffPerf7:cln_PairCA +
                         cp_OffPSC7:cln_OffObl7 + 
                         cp_OffPSC7:cln_OffFocus + 
                         Pricing:cln_PSCrate+
                         (1 | NAICS3/NAICS6/ServArea)+  
                         (1 | Agency/Office) +
                         (1 | Place)+ 
                         (1 | StartFY),
                       family=binomial(link="logit"),
                       verbose=TRUE)
  save(b_SomeOpt25B, b_AllOpt25B, file="..\Output\Opt25B.rda")
}




#Load experimental Some+All Opt Models
glmer_examine(b_AllOpt25B)
stargazer::stargazer(b_SomeOpt25A, b_SomeOpt25B, 
                     b_AllOpt25A, b_AllOpt25B, type = "text", digits = 2)
# 
# texreg::htmlreg(list(b_AllOpt25A, b_AllOpt25B),file="..//Output//all_options_comp.html",
#                 single.row = TRUE,
#                 custom.model.name=c("AO 25A", "AO 25B"),
#                 stars=c(0.1,0.05,0.01,0.001),
#                 # groups = list(
#                 #                "Services Complexity" = 2:3,
#                 #                "Office Capacity" =4:5,
#                 #                "Past Relationship"=6:7,
#                 #                "Contract Characteristics"=8:26,
#                 #                "NAICS Characteristics" =27:30,
#                 #                "Office Characteristics" =31:33,
#                 #                "Interactions"=34:39
#                 #               ),
#                 # custom.coef.map=all_coef_list,
#                 bold=0.05,
#                 custom.note="%stars. Numerical inputs are rescaled.",
#                 caption="Table 6: Exercised Options",
#                 caption.above=TRUE)
summary_residual_compare(b_SomeOpt25A, b_SomeOpt25B, 
                     b_AllOpt25A, b_AllOpt25B, bins=100)


```
BIC rises with the introduction  of the PSCrate / pricing variable. There is some support in the all options model, but the strange contradiction in  direction between incentive and cost-base contracts and the huge coefficient for pricing  UCA  suggests that something not well understood  is happening here. Residuals are also definitely showing more of a pattern for some options.

Leaving it out.

####25C: 2019-08-29 - Modified SomeOpt models to more accurately reflect variable trimming in prior sections.

```{r SomeOpt25C}

if(file.exists("..//Output//b_SomeOpt25C.rda")) load("..//Output//b_SomeOpt25C.rda")


#Note, does not include cln_Days
if(!exists("b_SomeOpt25C")){
  b_SomeOpt25C <- glmer(data=serv_opt, b_SomeOpt ~  cln_US6sal +
                          cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                          cn_PairHist7+cln_PairCA+
                          cln_Base + clr_Ceil2Base + #cln_Days+
                          Comp+
                          Veh+
                          Pricing+
                          Crisis+
                          cln_Def6HHI+clr_Def6toUS+
                          cln_Def3HHI+
                          clr_Def3toUS+
                          cp_PairObl7+
                          cln_OffObl7+
                          cln_OffFocus+
                          cp_OffPerf7:cp_PairObl7 +
                          cln_OffObl7:cp_PairObl7 + 
                          cn_PairHist7:Pricing + 
                          clr_Ceil2Base:cln_Base + 
                          cp_OffPSC7:cln_OffObl7 + 
                          (1 | NAICS3/NAICS6/ServArea)+
                          (1 | Agency/Office) +
                          (1 | Place)+
                          (1 | StartFY),
                        family=binomial(link="logit"),
                        verbose=TRUE)
  save(b_SomeOpt25C, file="..\\Output\\b_SomeOpt25C.rda")
}

glmer_examine(b_SomeOpt25C)
stargazer::stargazer(b_SomeOpt25A, b_SomeOpt25C, type = "text", digits = 2)

summary_residual_compare(b_SomeOpt25A, b_SomeOpt25C, bins=100)

```
AIC and BIC both rise, thoough residuals seem to be a bit more contracted in 25C. Dropping days appears to have been costly.

####25C2: 2019-08-29 - Modified SomeOpt models to more accurately reflect variable trimming in prior sections.

```{r SomeOpt25C2}

if(file.exists("..//Output//b_SomeOpt25Cv2.rda")) load("..//Output//b_SomeOpt25Cv2.rda")


if(!exists("b_SomeOpt25Cv2")){
  b_SomeOpt25Cv2 <- glmer(data=serv_opt, b_SomeOpt ~  cln_US6sal +
                            cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                            cn_PairHist7+cln_PairCA+
                            cln_Base + clr_Ceil2Base + cln_Days+
                            Comp+
                            Veh+
                            Pricing+
                            Crisis+
                            cln_Def6HHI+clr_Def6toUS+
                            cln_Def3HHI+
                            clr_Def3toUS+
                            cp_PairObl7+
                            cln_OffObl7+
                            cln_OffFocus+
                            cp_OffPerf7:cp_PairObl7 +
                            cln_OffObl7:cp_PairObl7 + 
                            cn_PairHist7:Pricing + 
                            clr_Ceil2Base:cln_Base + 
                            cp_OffPSC7:cln_OffObl7 + 
                            (1 | NAICS3/NAICS6/ServArea)+
                            (1 | Agency/Office) +
                            (1 | Place)+
                            (1 | StartFY),
                          family=binomial(link="logit"),
                          verbose=TRUE)
  save(b_SomeOpt25Bv2, file="..\\Output\\b_SomeOpt25Cv2.rda")
}

glmer_examine(b_SomeOpt25Cv2)
stargazer::stargazer(b_SomeOpt25A, b_SomeOpt25Cv2, type = "text", digits = 2)

summary_residual_compare(b_SomeOpt25A, b_SomeOpt25Cv2, bins=100)


```
AIC lower, BIC higher, residuals comparable. 

####25C3: 2019-08-29 - Modified SomeOpt models to more accurately reflect variable trimming in prior sections.

```{r SomeOpt25C3}
if(file.exists("..//Output//b_SomeOpt25Cv3.rda"))  load("..//Output//b_SomeOpt25Cv3.rda")

if(!exists("b_SomeOpt25Cv3")){
  b_SomeOpt25Cv3 <- glmer(data=serv_opt, b_SomeOpt ~  cln_US6sal +
                            cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                            cn_PairHist7+cln_PairCA+
                            cln_Base + clr_Ceil2Base + cln_Days+
                            Comp+
                            Veh+
                            Pricing+
                            Crisis+
                            cln_Def6HHI+clr_Def6toUS+
                            cln_Def3HHI+
                            clr_Def3toUS+
                            cp_PairObl7+
                            cln_OffObl7+
                            cln_OffFocus+
                            cp_OffPerf7:cp_PairObl7 +
                            cln_OffObl7:cp_PairObl7 + 
                            cn_PairHist7:Pricing + 
                            cp_OffPerf7:cln_PairCA +
                            clr_Ceil2Base:cln_Base + 
                            cp_OffPSC7:cln_OffObl7 + 
                            (1 | NAICS3/NAICS6/ServArea)+
                            (1 | Agency/Office) +
                            (1 | Place)+
                            (1 | StartFY),
                          family=binomial(link="logit"),
                          verbose=TRUE)
  save(b_SomeOpt25Cv3, file="..\\Output\\b_SomeOpt25Cv3.rda")
  
}
  

# texreg::htmlreg(list(b_SomeOpt25A, b_SomeOpt25C, b_SomeOpt25Cv3),file="..//Output//some_options_comp.html",
#                 single.row = TRUE,
#                 custom.model.name=c("SO 25A", "SO 25C", "SO 25Cv2"),
#                 stars=c(0.1,0.05,0.01,0.001),
#                 # groups = list(
#                 #                "Services Complexity" = 2:3,
#                 #                "Office Capacity" =4:5,
#                 #                "Past Relationship"=6:7,
#                 #                "Contract Characteristics"=8:26,
#                 #                "NAICS Characteristics" =27:30,
#                 #                "Office Characteristics" =31:33,
#                 #                "Interactions"=34:39
#                 #               ),
#                 # custom.coef.map=all_coef_list,
#                 bold=0.05,
#                 custom.note="%stars. Numerical inputs are rescaled.",
#                 caption="Table 6: Exercised Options",
#                 caption.above=TRUE)
# 
# texreg::htmlreg(list(b_SomeOpt25A, b_SomeOpt25C, b_SomeOpt25Cv3, b_SomeOpt25Cv3),file="..//Output//some_options_comp.html",
#                 single.row = TRUE,
#                 custom.model.name=c("SO 25A", "SO 25C", "SO 25Cv2", "SO 25Cv3"),
#                 stars=c(0.1,0.05,0.01,0.001),
#                 bold=0.05,
#                 custom.note="%stars. Numerical inputs are rescaled.",
#                 caption="Table 6: Exercised Options",
#                 caption.above=TRUE)
# 

glmer_examine(b_SomeOpt25Cv3)

stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B,b_SomeOpt25A, b_SomeOpt25Cv2,
                     b_SomeOpt25Cv3, type = "text", digits = 2)

summary_residual_compare(b_SomeOpt25A, b_SomeOpt25Cv3,
                     b_SomeOpt25Cv2,b_SomeOpt25Cv3, bins=100)



```



####26A: 2019-08-31 - Rerun with updated interactions after pOffPSC->clp_OffPSC fix

```{r SomeOpt26A}
if(file.exists("..//Output//b_SomeOpt26A.rda"))  load("..//Output//b_SomeOpt26A.rda")

if(!exists("b_SomeOpt26A")){
  b_SomeOpt26A <- glmer(data=serv_opt,
                        b_SomeOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+#cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+ 
                cp_OffPerf7:cp_PairObl7+
                 cp_OffPerf7:cln_Days+
                  cn_PairHist7:Pricing +
                   clr_Ceil2Base:cln_Base+
                            (1 | NAICS3/NAICS6/ServArea)+
                            (1 | Agency/Office) +
                            (1 | Place)+
                            (1 | StartFY),
                          family=binomial(link="logit"),
                          verbose=TRUE)
  save(b_SomeOpt26A, file="..\\Output\\b_SomeOpt26A.rda")
  
  
  
  
  b_AllOpt26A <- glmer(data=serv_opt,
                       b_AllOpt ~  cln_US6sal + 
                   cln_PSCrate+ cp_OffPerf7+cp_OffPSC7+
                 cn_PairHist7+cln_PairCA+
                 cln_Base + clr_Ceil2Base + cln_Days+
                 Comp+
                   Veh+
                   Pricing+
                   Crisis+
                 cln_Def6HHI+clr_Def6toUS+
                 cln_Def3HHI+
                   clr_Def3toUS+
                 cp_PairObl7+
                   cln_OffObl7+ 
                 cln_OffFocus+
                   cp_OffPerf7:cp_PairObl7 + 
                  # cp_OffPerf7:cln_PairCA + 
                   cp_OffPSC7:cln_OffFocus+
                   
                   Pricing:cln_PSCrate+
                      # cp_OffPerf7:cln_Days+
                 # Pricing:cln_PSCrate+
                   cln_OffObl7:cln_OffFocus+
                      (1 | NAICS3/NAICS6/ServArea)+  
                      (1 | Agency/Office) +
                      (1 | Place)+ 
                      (1 | StartFY),
                      family=binomial(link="logit"),
                      verbose=TRUE)
  
  save(b_AllOpt26A,file="..\\output\\b_AllOpt26A.rda")
}
  

# texreg::htmlreg(list(b_SomeOpt25A, b_SomeOpt25C, b_SomeOpt26A),file="..//Output//some_options_comp.html",
#                 single.row = TRUE,
#                 custom.model.name=c("SO 25A", "SO 25C", "SO 25Cv2"),
#                 stars=c(0.1,0.05,0.01,0.001),
#                 # groups = list(
#                 #                "Services Complexity" = 2:3,
#                 #                "Office Capacity" =4:5,
#                 #                "Past Relationship"=6:7,
#                 #                "Contract Characteristics"=8:26,
#                 #                "NAICS Characteristics" =27:30,
#                 #                "Office Characteristics" =31:33,
#                 #                "Interactions"=34:39
#                 #               ),
#                 # custom.coef.map=all_coef_list,
#                 bold=0.05,
#                 custom.note="%stars. Numerical inputs are rescaled.",
#                 caption="Table 6: Exercised Options",
#                 caption.above=TRUE)
# 
# texreg::htmlreg(list(b_SomeOpt25A, b_SomeOpt25C, b_SomeOpt25Cv3, b_SomeOpt25Cv3),file="..//Output//some_options_comp.html",
#                 single.row = TRUE,
#                 custom.model.name=c("SO 25A", "SO 25C", "SO 25Cv2", "SO 25Cv3"),
#                 stars=c(0.1,0.05,0.01,0.001),
#                 bold=0.05,
#                 custom.note="%stars. Numerical inputs are rescaled.",
#                 caption="Table 6: Exercised Options",
#                 caption.above=TRUE)
# 

glmer_examine(b_SomeOpt25Cv3)

stargazer::stargazer(b_SomeOpt_base2ceil_ceiling_21B,b_SomeOpt25A, b_SomeOpt25Cv2,
                     b_SomeOpt25Cv3, b_SomeOpt26A,type = "text", digits = 2)

summary_residual_compare(b_SomeOpt25A, b_SomeOpt25Cv3,
                     b_SomeOpt25Cv2,b_SomeOpt25Cv3, bins=100)



```